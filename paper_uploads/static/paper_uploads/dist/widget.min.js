!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/static/paper_uploads/dist/",n(n.s=34)}([function(e,t,n){"use strict";var o=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===i}(e)}(e)};var i="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function r(e,t){return!1!==t.clone&&t.isMergeableObject(e)?c((n=e,Array.isArray(n)?[]:{}),e,t):e;var n}function a(e,t,n){return e.concat(t).map((function(e){return r(e,n)}))}function s(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function u(e,t){try{return t in e}catch(e){return!1}}function l(e,t,n){var o={};return n.isMergeableObject(e)&&s(e).forEach((function(t){o[t]=r(e[t],n)})),s(t).forEach((function(i){(function(e,t){return u(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,i)||(n.isMergeableObject(t[i])&&u(e,i)?o[i]=function(e,t){if(!t.customMerge)return c;var n=t.customMerge(e);return"function"==typeof n?n:c}(i,n)(e[i],t[i],n):o[i]=r(t[i],n))})),o}function c(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||a,n.isMergeableObject=n.isMergeableObject||o,n.cloneUnlessOtherwiseSpecified=r;var i=Array.isArray(t);return i===Array.isArray(e)?i?n.arrayMerge(e,t,n):l(e,t,n):r(t,n)}c.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return c(e,n,t)}),{})};var d=c;e.exports=d},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;!function(global){var qq=function e(t){"use strict";return{hide:function(){return t.style.display="none",this},attach:function(n,o){return t.addEventListener?t.addEventListener(n,o,!1):t.attachEvent&&t.attachEvent("on"+n,o),function(){e(t).detach(n,o)}},detach:function(e,n){return t.removeEventListener?t.removeEventListener(e,n,!1):t.attachEvent&&t.detachEvent("on"+e,n),this},contains:function(e){return!!e&&(t===e||(t.contains?t.contains(e):!!(8&e.compareDocumentPosition(t))))},insertBefore:function(e){return e.parentNode.insertBefore(t,e),this},remove:function(){return t.parentNode.removeChild(t),this},css:function(n){if(null==t.style)throw new e.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=n.opacity&&"string"!=typeof t.style.opacity&&void 0!==t.filters&&(n.filter="alpha(opacity="+Math.round(100*n.opacity)+")"),e.extend(t.style,n),this},hasClass:function(e,n){var o=new RegExp("(^| )"+e+"( |$)");return o.test(t.className)||!(!n||!o.test(t.parentNode.className))},addClass:function(n){return e(t).hasClass(n)||(t.className+=" "+n),this},removeClass:function(e){var n=new RegExp("(^| )"+e+"( |$)");return t.className=t.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(n,o){var i,r=[];return o&&t.querySelector?t.querySelector("."+n):t.querySelectorAll?t.querySelectorAll("."+n):(i=t.getElementsByTagName("*"),e.each(i,(function(t,o){e(o).hasClass(n)&&r.push(o)})),o?r[0]:r)},getFirstByClass:function(n){return e(t).getByClass(n,!0)},children:function(){for(var e=[],n=t.firstChild;n;)1===n.nodeType&&e.push(n),n=n.nextSibling;return e},setText:function(e){return t.innerText=e,t.textContent=e,this},clearText:function(){return e(t).setText("")},hasAttribute:function(e){var n;return t.hasAttribute?!!t.hasAttribute(e)&&null==/^false$/i.exec(t.getAttribute(e)):void 0!==(n=t[e])&&null==/^false$/i.exec(n)}}},ExifRestorer;!function(){"use strict";var div;qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,o,i,r,a,s,u;return n=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),o=new Uint8Array(t),qq.each(n,(function(e,t){o[e]=t.charCodeAt(0)})),r=t,a=i,s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,(u=s&&new s)?(u.append(r),u.getBlob(a)):new Blob([r],{type:a})},qq.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},qq.isObject=function(e){return e&&!e.nodeType&&"[object Object]"===Object.prototype.toString.call(e)},qq.isFunction=function(e){return"function"==typeof e},qq.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return"[object DataTransferItemList]"===Object.prototype.toString.call(e)},qq.isNodeList=function(e){return"[object NodeList]"===Object.prototype.toString.call(e)||e.item&&e.namedItem},qq.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,o=n.indexOf("{}");return qq.each(t,(function(e,t){var i=n.substring(0,o),r=n.substring(o+2);if((o=(n=i+t+r).indexOf("{}",o+t.length))<0)return!1})),n},qq.isFile=function(e){return window.File&&"[object File]"===Object.prototype.toString.call(e)},qq.isFileList=function(e){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(e)},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(e){var n=e.toLowerCase();return t?"file"!==n:"file"===n};return!!(window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(e)&&e.type&&n(e.type))||!!(e.tagName&&"input"===e.tagName.toLowerCase()&&e.type&&n(e.type))},qq.isBlob=function(e){if(window.Blob&&"[object Blob]"===Object.prototype.toString.call(e))return!0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",void 0!==e.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&void 0!==qq.createXhrInstance().upload},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qq.sliceBlob=function(e,t,n){return(e.slice||e.mozSlice||e.webkitSlice).call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,(function(e,n){var o=n.toString(16);o.length<2&&(o="0"+o),t+=o})),t},qq.readBlobToHex=function(e,t,n){var o=qq.sliceBlob(e,t,t+n),i=new FileReader,r=new qq.Promise;return i.onload=function(){r.success(qq.arrayBufferToHex(i.result))},i.onerror=r.failure,i.readAsArrayBuffer(o),r},qq.extend=function(e,t,n){return qq.each(t,(function(t,o){n&&qq.isObject(o)?(void 0===e[t]&&(e[t]={}),qq.extend(e[t],o,!0)):e[t]=o})),e},qq.override=function(e,t){var n={},o=t(n);return qq.each(o,(function(t,o){void 0!==e[t]&&(n[t]=e[t]),e[t]=o})),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var o=e.length;for(n<0&&(n+=o);n<o;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},qq.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")},qq.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")},qq.ie8=function(){return-1!==navigator.userAgent.indexOf("MSIE 8")},qq.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},qq.ie11=function(){return qq.ie()&&-1!==navigator.userAgent.indexOf("rv:11")},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){return"Win32"===navigator.platform},qq.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0&&navigator.userAgent.toLowerCase().indexOf("firefox")<0},qq.ios6=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 6_")},qq.ios7=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")},qq.ios8=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_")},qq.ios800=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_0 ")},qq.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qq.iosChrome=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf("CriOS")},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&-1!==navigator.userAgent.indexOf("Safari")},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=(div=document.createElement("div"),function(e){div.innerHTML=e;var t=div.firstChild;return div.removeChild(t),t}),qq.each=function(e,t){var n;if(e)if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&!1!==t(e.key(n),e.getItem(e.key(n)));n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&!1!==t(n,e[n]);n++);else if(qq.isString(e))for(n=0;n<e.length&&!1!==t(n,e.charAt(n));n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&!1===t(n,e[n]))break},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var o=qq.extend([],n);return arguments.length&&(o=o.concat(Array.prototype.slice.call(arguments))),e.apply(t,o)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var o=[],i="&",r=function(e,n){var i=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;"undefined"!==i&&"undefined"!==n&&o.push("object"==typeof e?qq.obj2url(e,i,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(i)+"="+encodeURIComponent(e()):encodeURIComponent(i)+"="+encodeURIComponent(e))};return!n&&t?(i=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",o.push(t),o.push(qq.obj2url(e))):"[object Array]"===Object.prototype.toString.call(e)&&void 0!==e?qq.each(e,(function(e,t){r(t,e)})):null!=e&&"object"==typeof e?qq.each(e,(function(e,t){r(t,e)})):o.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?o.join(i):o.join(i).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,(function(e,o){e=n?n+"["+e+"]":e,qq.isObject(o)?qq.obj2FormData(o,t,e):qq.isFunction(o)?t.append(e,o()):t.append(e,o)})),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(e,o){(n=document.createElement("input")).setAttribute("name",e),n.setAttribute("value",o),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do{(t=e.shift())&&t()}while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}}(),function(){"use strict";void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return qq}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}(),function(){"use strict";qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e},qq.Error.prototype=new Error}(),qq.version="6.0.2",qq.supportedFeatures=function(){"use strict";var e,t,n,o,i,r,a,s,u,l,c,d,p,f,h,m,q;function g(){return!!window.XMLHttpRequest&&void 0!==qq.createXhrInstance().withCredentials}function _(){return void 0!==window.XDomainRequest}return e=function(){var e,t=!0;try{(e=document.createElement("input")).type="file",qq(e).hide(),e.disabled&&(t=!1)}catch(e){t=!1}return t}(),t=(o=e&&qq.isXhrUploadSupported())&&!qq.androidStock(),i=(n=o&&(("draggable"in(m=document.createElement("span"))||"ondragstart"in m&&"ondrop"in m)&&!qq.android()&&!qq.ios()))&&((q=document.createElement("input")).type="file",!!("webkitdirectory"in(q||document.querySelectorAll("input[type=file]")[0]))),r=o&&qq.isFileChunkingSupported(),a=o&&r&&function(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch(e){return!1}}(),s=o&&(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/),u=e&&(void 0!==window.postMessage||o),c=g(),l=_(),d=!!g()||_(),p=void 0!==document.createElement("input").webkitdirectory,f=o&&void 0!==window.FileReader,h=!!o&&!qq.androidStock()&&!qq.iosChrome(),{ajaxUploading:o,blobUploading:t,canDetermineSize:o,chunking:r,deleteFileCors:d,deleteFileCorsXdr:l,deleteFileCorsXhr:c,dialogElement:!!window.HTMLDialogElement,fileDrop:n,folderDrop:i,folderSelection:p,imagePreviews:f,imageValidation:f,itemSizeValidation:o,pause:r,progressBar:h,resume:a,scaling:f&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:u,uploadCustomHeaders:o,uploadNonMultipart:o,uploadViaPaste:s}}(),qq.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){"use strict";var e,t,n=[],o=[],i=[],r=0;qq.extend(this,{then:function(i,a){return 0===r?(i&&n.push(i),a&&o.push(a)):-1===r?a&&a.apply(null,t):i&&i.apply(null,e),this},done:function(n){return 0===r?i.push(n):n.apply(null,void 0===t?e:t),this},success:function(){return r=1,e=arguments,n.length&&qq.each(n,(function(t,n){n.apply(null,e)})),i.length&&qq.each(i,(function(t,n){n.apply(null,e)})),this},failure:function(){return r=-1,t=arguments,o.length&&qq.each(o,(function(e,n){n.apply(null,t)})),i.length&&qq.each(i,(function(e,n){n.apply(null,t)})),this}})},qq.BlobProxy=function(e,t){"use strict";qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qq.UploadButton=function(e){"use strict";var t,n,o=this,i=new qq.DisposeSupport,r={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(e){},title:null};function a(){var e=document.createElement("input");return e.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,n),e.setAttribute("title",r.title),o.setMultiple(r.multiple,e),r.folders&&qq.supportedFeatures.folderSelection&&e.setAttribute("webkitdirectory",""),r.acceptFiles&&e.setAttribute("accept",r.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",r.name),qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(e).css({height:"100%"}),r.element.appendChild(e),i.attach(e,"change",(function(){r.onChange(e)})),i.attach(e,"mouseover",(function(){qq(r.element).addClass(r.hoverClass)})),i.attach(e,"mouseout",(function(){qq(r.element).removeClass(r.hoverClass)})),i.attach(e,"focus",(function(){qq(r.element).addClass(r.focusClass)})),i.attach(e,"blur",(function(){qq(r.element).removeClass(r.focusClass)})),e}qq.extend(r,e),n=qq.getUniqueId(),qq(r.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return t},getButtonId:function(){return n},setMultiple:function(e,t){var n=t||this.getInput();r.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())?n.setAttribute("multiple",""):e?n.setAttribute("multiple",""):n.removeAttribute("multiple")},setAcceptFiles:function(e){e!==r.acceptFiles&&t.setAttribute("accept",e)},reset:function(){t.parentNode&&qq(t).remove(),qq(r.element).removeClass(r.focusClass),t=null,t=a()}}),t=a()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(e){"use strict";var t=[],n={},o={},i={},r={};function a(e){if(qq.isArray(e)){var n=[];return qq.each(e,(function(e,o){n.push(t[o])})),n}return t[e]}qq.extend(this,{addFile:function(a){var s=a.status||qq.status.SUBMITTING,u=t.push({name:a.name,originalName:a.name,uuid:a.uuid,size:null==a.size?-1:a.size,status:s,file:a.file})-1;return a.batchId&&(t[u].batchId=a.batchId,void 0===r[a.batchId]&&(r[a.batchId]=[]),r[a.batchId].push(u)),a.proxyGroupId&&(t[u].proxyGroupId=a.proxyGroupId,void 0===i[a.proxyGroupId]&&(i[a.proxyGroupId]=[]),i[a.proxyGroupId].push(u)),t[u].id=u,n[a.uuid]=u,void 0===o[s]&&(o[s]=[]),o[s].push(u),a.onBeforeStatusChange&&a.onBeforeStatusChange(u),e.onStatusChange(u,null,s),u},retrieve:function(e){return qq.isObject(e)&&t.length?void 0!==e.id?a(e.id):void 0!==e.uuid?function(e){if(qq.isArray(e)){var o=[];return qq.each(e,(function(e,i){o.push(t[n[i]])})),o}return t[n[e]]}(e.uuid):e.status?(i=e.status,r=[],s=[].concat(i),qq.each(s,(function(e,n){var i=o[n];void 0!==i&&qq.each(i,(function(e,n){r.push(t[n])}))})),r):void 0:qq.extend([],t,!0);var i,r,s},removeFileRef:function(e){var t=a(e);t&&delete t.file},reset:function(){t=[],n={},o={},r={}},setStatus:function(n,i){var r=t[n].status,a=qq.indexOf(o[r],n);o[r].splice(a,1),t[n].status=i,void 0===o[i]&&(o[i]=[]),o[i].push(n),e.onStatusChange(n,r,i)},uuidChanged:function(e,o){var i=t[e].uuid;t[e].uuid=o,n[o]=e,delete n[i]},updateName:function(e,n){t[e].name=n},updateSize:function(e,n){t[e].size=n},setParentId:function(e,n){t[e].parentId=n},getIdsInProxyGroup:function(e){var n=t[e].proxyGroupId;return n?i[n]:[]},getIdsInBatch:function(e){var n=t[e].batchId;return r[n]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_FINALIZING:"upload finalizing",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";qq.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addInitialFiles:function(e){var t=this;qq.each(e,(function(e,n){t._addCannedFile(n)}))},addFiles:function(e,t,n){this._maybeHandleIos8SafariWorkaround();var o=0===this._storedIds.length?qq.getUniqueId():this._currentBatchId,i=qq.bind((function(e){this._handleNewFile({blob:e,name:this._options.blobs.defaultName},o,c)}),this),r=qq.bind((function(e){this._handleNewFile(e,o,c)}),this),a=qq.bind((function(e){var t=qq.canvasToBlob(e);this._handleNewFile({blob:t,name:this._options.blobs.defaultName+".png"},o,c)}),this),s=qq.bind((function(e){var t=e.quality&&e.quality/100,n=qq.canvasToBlob(e.canvas,e.type,t);this._handleNewFile({blob:n,name:e.name},o,c)}),this),u=qq.bind((function(e){if(qq.isInput(e)&&qq.supportedFeatures.ajaxUploading){var t=Array.prototype.slice.call(e.files),n=this;qq.each(t,(function(e,t){n._handleNewFile(t,o,c)}))}else this._handleNewFile(e,o,c)}),this),l=this,c=[];this._currentBatchId=o,e&&(qq.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e),qq.each(e,(function(e,t){qq.isFileOrInput(t)?u(t):qq.isBlob(t)?i(t):qq.isObject(t)?t.blob&&t.name?r(t):t.canvas&&t.name&&s(t):t.tagName&&"canvas"===t.tagName.toLowerCase()?a(t):l.log(t+" is not a valid file container!  Ignoring!","warn")})),this.log("Received "+c.length+" files."),this._prepareItemsForUpload(c,t,n))},cancel:function(e){var t=this._uploadData.retrieve({id:e});t&&t.status===qq.status.UPLOAD_FINALIZING?this.log(qq.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.",e,this.getName(e)),"error"):this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds),qq.each(e,(function(e,n){t.cancel(n)})),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return!(!qq.supportedFeatures.pause||!this._options.chunking.enabled)&&(t.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1))},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,o,i){var r,a,s=new qq.Promise;return this._imageGenerator?(r=this._thumbnailUrls[e],a={customResizeFunction:i,maxSize:n>0?n:null,scale:n>0},!o&&qq.supportedFeatures.imagePreviews&&(r=this.getFile(e)),null==r?s.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(r,t,a).then((function(e){s.success(e)}),(function(e,t){s.failure({container:e,error:t||"Problem generating thumbnail"})}))):s.failure({container:t,error:"Missing image generator module"}),s},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){var t,n=this._handler.getFile(e);return n||(t=this._uploadData.retrieve({id:e}))&&(n=t.file),n||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&void 0!==t.parentId&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},isResumable:function(e){return this._handler.hasResumeRecord(e)},log:function(e,t){!this._options.debug||t&&"info"!==t?t&&"info"!==t&&qq.log("[Fine Uploader "+qq.version+"] "+e,t):qq.log("[Fine Uploader "+qq.version+"] "+e)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},removeFileRef:function(e){this._handler.expunge(e),this._uploadData.removeFileRef(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,(function(e,t){t.reset()})),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset(),this._customResumeDataStore.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(this.log,this),getFile:qq.bind(this.getFile,this),uploadData:this._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setCustomResumeData:function(e,t){this._customResumeDataStore.set(t,e)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,t){if(!this.getUploads({id:e}))throw new qq.Error(e+" is not a valid file ID.");switch(t){case qq.status.DELETED:this._onDeleteComplete(e,null,!1);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(e,null,!0);break;default:var n="Method setStatus called on '"+name+"' not implemented yet for "+t;throw this.log(n),new qq.Error(n)}},uploadStoredFiles:function(){0===this._storedIds.length?this._itemError("noFilesError"):this._uploadStoredFiles()}},qq.basePrivateApi={_addCannedFile:function(e){var t=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(n){e.deleteFileEndpoint&&t.setDeleteFileEndpoint(e.deleteFileEndpoint,n),e.deleteFileParams&&t.setDeleteFileParams(e.deleteFileParams,n),e.thumbnailUrl&&(t._thumbnailUrls[n]=e.thumbnailUrl),t._netUploaded++,t._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,t){qq.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,o){e._onDeleteComplete(t,n,o),e._options.callbacks.onDeleteComplete(t,n,o)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},o=e,i={},r=t,a=function(e){return qq.isObject(e)?qq.extend({},e):e},s=function(e,t){r&&qq.isObject(t)&&qq.extend(t,qq.isFunction(r)?r():r),i[e]&&qq.extend(t,i[e])};return{set:function(e,t){null==t?(n={},o=a(e)):n[t]=a(e)},get:function(e){var t;return t=null!=e&&n[e]?n[e]:a(o),s(e,t),a(t)},addReadOnly:function(e,t){qq.isObject(n)&&(null===e?qq.isFunction(t)?r=t:(r=r||{},qq.extend(r,t)):(i[e]=i[e]||{},qq.extend(i[e],t)))},remove:function(e){return delete n[e]},reset:function(){n={},i={},o=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,o){e._onUploadStatusChange(t,n,o),e._options.callbacks.onStatusChange(t,n,o),e._maybeAllComplete(t,o),e._totalProgress&&setTimeout((function(){e._totalProgress.onStatusChange(t,n,o)}),0)}})},_createUploadButton:function(e){var t,n=this,o=e.accept||this._options.validation.acceptFiles,i=e.allowedExtensions||this._options.validation.allowedExtensions;return t=new qq.UploadButton({acceptFiles:o,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:!!qq.supportedFeatures.ajaxUploading&&!(n._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&n._isAllowedExtension(i,".mov"))&&(void 0===e.multiple?n._options.multiple:e.multiple),name:this._options.request.inputName,onChange:function(e){n._onInputChange(e)},title:null==e.title?this._options.text.fileInputTitle:e.title}),this._disposeSupport.addDisposer((function(){t.dispose()})),n._buttons.push(t),t},_createUploadHandler:function(e,t){var n=this,o={},i={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(e,t,i,r){i<0||r<0||(o[e]&&o[e].loaded===i&&o[e].total===r||(n._onProgress(e,t,i,r),n._options.callbacks.onProgress(e,t,i,r)),o[e]={loaded:i,total:r})},onComplete:function(e,t,i,r){delete o[e];var a,s=n.getUploads({id:e}).status;s!==qq.status.UPLOAD_SUCCESSFUL&&s!==qq.status.UPLOAD_FAILED&&((a=n._onComplete(e,t,i,r))instanceof qq.Promise?a.done((function(){n._options.callbacks.onComplete(e,t,i,r)})):n._options.callbacks.onComplete(e,t,i,r))},onCancel:function(e,t,o){var i=new qq.Promise;return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,e,t),onFailure:i.failure,onSuccess:function(){o.then((function(){n._onCancel(e,t)})),i.success()},identifier:e}),i},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(e,t){n._onUpload(e,t);var o=n._options.callbacks.onUpload(e,t);return qq.isGenericPromise(o)?(n.log(qq.format("onUpload for {} returned a Promise - waiting for resolution.",e)),o):(new qq.Promise).success()},onUploadChunk:function(e,t,o){n._onUploadChunk(e,o);var i=n._options.callbacks.onUploadChunk(e,t,o);return qq.isGenericPromise(i)?(n.log(qq.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.",e,o.partIndex)),i):(new qq.Promise).success()},onUploadChunkSuccess:function(e,t,o,i){n._onUploadChunkSuccess(e,t),n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(e,t,o,i){return n._options.callbacks.onResume(e,t,o,i)},onAutoRetry:function(e,t,o,i){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(e,t){n.log("Server requested UUID change from '"+n.getUuid(e)+"' to '"+t+"'"),n.setUuid(e,t)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(e){return n.getUploads({uuid:e})},isQueued:function(e){var t=n.getUploads({id:e}).status;return t===qq.status.QUEUED||t===qq.status.SUBMITTED||t===qq.status.UPLOAD_RETRYING||t===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch,isInProgress:function(e){return n.getUploads({id:e}).status===qq.status.UPLOADING},getCustomResumeData:qq.bind(n._getCustomResumeData,n),setStatus:function(e,t){n._uploadData.setStatus(e,t)}};return qq.each(this._options.request,(function(e,t){i[e]=t})),i.customHeaders=this._customHeadersStore,e&&qq.each(e,(function(e,t){i[e]=t})),new qq.UploadHandlerController(i,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){if(0===e)return e+this._options.text.sizeSymbols[0];var t=-1;do{e/=1024,t++}while(e>1023);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,(function(t,n){var o=n.multiple,i=qq.extend({},e._options.validation,!0),r=qq.extend({},n);void 0===o&&(o=e._options.multiple),r.validation&&qq.extend(i,n.validation,!0),qq.extend(r,{multiple:o,validation:i},!0),e._initExtraButton(r)}))},_getButton:function(e){var t=this._extraButtonSpecs[e];return t?t.element:e===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(e){var t,n,o=e;if(o instanceof qq.BlobProxy&&(o=o.referenceBlob),o&&!qq.isBlob(o)){if(qq.isFile(o))return o.qqButtonId;if("input"===o.tagName.toLowerCase()&&"file"===o.type.toLowerCase())return o.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(t=o.getElementsByTagName("input"),qq.each(t,(function(e,t){if("file"===t.getAttribute("type"))return n=t,!1})),n)return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getCustomResumeData:function(e){return this._customResumeDataStore.get(e)},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qq.BlobProxy?{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];return qq.each(e,(function(e,o){n.push(t._getValidationDescriptor(o))})),n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e=this._options.camera.button,t=e?this._getButtonId(e):this._defaultButtonId,n=this._options;t&&t!==this._defaultButtonId&&(n=this._extraButtonSpecs[t]),n.multiple=!1,null===n.validation.acceptFiles?n.validation.acceptFiles="image/*;capture=camera":n.validation.acceptFiles+=",image/*;capture=camera",qq.each(this._buttons,(function(e,o){if(o.getButtonId()===t)return o.setMultiple(n.multiple),o.setAcceptFiles(n.acceptFiles),!1}))}},_handleCheckedCallback:function(e){var t=this,n=e.callback();return qq.isGenericPromise(n)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),n.then((function(n){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(n)}),(function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)}))):(!1!==n?e.onSuccess(n):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),n)},_handleNewFile:function(e,t,n){var o=this,i=qq.getUniqueId(),r=-1,a=qq.getFilename(e),s=e.blob||e,u=this._customNewFileHandler?this._customNewFileHandler:qq.bind(o._handleNewFileGeneric,o);!qq.isInput(s)&&s.size>=0&&(r=s.size),u(s,a,i,r,n,t,this._options.request.uuidName,{uploadData:o._uploadData,paramsStore:o._paramsStore,addFileToHandler:function(e,t){o._handler.add(e,t),o._netUploadedOrQueued++,o._trackButton(e)}})},_handleNewFileGeneric:function(e,t,n,o,i,r){var a=this._uploadData.addFile({uuid:n,name:t,size:o,batchId:r,file:e});this._handler.add(a,e),this._trackButton(a),this._netUploadedOrQueued++,i.push({id:a,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],o=t;null==o&&(o=this._options.paste.defaultName),o+="."+n,this.addFiles({name:o,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==qq.status.DELETED){var t=this.getName(e);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qq.status.DELETED),this.log("Delete request for '"+t+"' has succeeded.")}},_handleDeleteFailed:function(e,t){var n=this.getName(e);this._uploadData.setStatus(e,qq.status.DELETE_FAILED),this.log("Delete request for '"+n+"' has failed.","error"),t&&void 0!==t.withCredentials?this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t):this._options.callbacks.onError(e,n,"Delete request failed",t)},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!(!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled)&&(!this._options.cors.expected||(!!qq.supportedFeatures.deleteFileCorsXhr||!(!qq.supportedFeatures.deleteFileCorsXdr||!this._options.cors.allowXdr)))},_isAllowedExtension:function(e,t){var n=!1;return!e.length||(qq.each(e,(function(e,o){if(qq.isString(o)){var i=new RegExp("\\."+o+"$","i");if(null!=t.match(i))return n=!0,!1}})),n)},_itemError:function(e,t,n){var o,i,r=this._options.messages[e],a=[],s=[].concat(t),u=s[0],l=this._getButtonId(n),c=this._getValidationBase(l);function d(e,t){r=r.replace(e,t)}return qq.each(c.allowedExtensions,(function(e,t){qq.isString(t)&&a.push(t)})),o=a.join(", ").toLowerCase(),d("{file}",this._options.formatFileName(u)),d("{extensions}",o),d("{sizeLimit}",this._formatSize(c.sizeLimit)),d("{minSizeLimit}",this._formatSize(c.minSizeLimit)),null!==(i=r.match(/(\{\w+\})/g))&&qq.each(i,(function(e,t){d(t,s[e])})),this._options.callbacks.onError(null,u,r,void 0),r},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e))return this._netUploadedOrQueued++,this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0},_maybeAllComplete:function(e,t){var n=this,o=this._getNotFinished();t===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t!==qq.status.UPLOAD_FAILED&&t!==qq.status.REJECTED&&t!==qq.status.CANCELED||this._failedSinceLastAllComplete.push(e),0===o&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout((function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)}),0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout((function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)}),0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,n,o){if(!n.success)if(o&&200!==o.status&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+o.status,o);else{var i=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,i,o)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,o,i){var r=this;if(t.length>n)if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout((function(){var e=r._getValidationDescriptor(t[n]),a=r._getButtonId(t[n].file),s=r._getButton(a);r._handleCheckedCallback({name:"onValidate",callback:qq.bind(r._options.callbacks.onValidate,r,e,s),onSuccess:qq.bind(r._onValidateCallbackSuccess,r,t,n,o,i),onFailure:qq.bind(r._onValidateCallbackFailure,r,t,n,o,i),identifier:"Item '"+e.name+"', size: "+e.size})}),0);else if(!e)for(;n<t.length;n++)r._fileOrBlobRejected(t[n].id)},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,o,i){var r=this;if(r._preventRetries[e]=n[r._options.retry.preventRetryResponseProperty],r._shouldAutoRetry(e)){var a=1e3*r._options.retry.autoAttemptDelay;return r._maybeParseAndSendUploadError.apply(r,arguments),r._options.callbacks.onAutoRetry(e,t,r._autoRetries[e]),r._onBeforeAutoRetry(e,t),r._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),r._retryTimeouts[e]=setTimeout((function(){r.log("Starting retry for "+t+"..."),i?i(e):r._handler.retry(e)}),a),!0}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t,n=this._currentItemLimit;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(t=this.getName(e),!1!==this._options.callbacks.onManualRetry(e,t)&&(n>0&&this._netUploadedOrQueued+1>n?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+t+"' (id: "+e+")..."),!0))):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);!this._options.autoUpload&&n>=0&&this._storedIds.splice(n,1),this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,o){return n.success?(n.thumbnailUrl&&(this._thumbnailUrls[e]=n.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED),!0===n[this._options.retry.preventRetryResponseProperty]&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,n,o),!!n.success},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){this.getName(e);n?this._handleDeleteFailed(e,t):this._handleDeleteSuccess(e)},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qq.each(this._buttons,(function(e,t){t.reset()}))},_onProgress:function(e,t,n,o){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,o)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(e)):(this._storeForLater(e),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(e,t,n){var o,i=this.getUuid(e);return t&&(o=qq.bind(t,this,e,i,n)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:o||qq.bind(this._deleteHandler.sendDelete,this,e,i,n),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadChunkSuccess:function(e,t){!this._preventRetries[e]&&this._options.retry.enableAuto&&(this._autoRetries[e]=0)},_onUploadStatusChange:function(e,t,n){n===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,(function(e,n){t._fileOrBlobRejected(n.id)}))},_onValidateBatchCallbackSuccess:function(e,t,n,o,i){var r,a=this._currentItemLimit,s=this._netUploadedOrQueued;0===a||s<=a?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],i),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,o),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,o),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),r=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,s).replace(/\{itemLimit\}/g,a),this._batchError(r))},_onValidateCallbackFailure:function(e,t,n,o){var i=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,i,n,o)},_onValidateCallbackSuccess:function(e,t,n,o){var i=this,r=t+1,a=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],a).then((function(){i._upload(e[t].id,n,o),i._maybeProcessNextItemAfterOnValidateCallback(!0,e,r,n,o)}),(function(){i._maybeProcessNextItemAfterOnValidateCallback(!1,e,r,n,o)}))},_prepareItemsForUpload:function(e,t,n){if(0!==e.length){var o=this._getValidationDescriptors(e),i=this._getButtonId(e[0].file),r=this._getButton(i);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,o,r),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,o,e,t,n,r),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})}else this._itemError("noFilesError")},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",(function(t){if(e.getInProgress())return(t=t||window.event).returnValue=e._options.messages.onLeave,e._options.messages.onLeave}))},_refreshSessionData:function(){var e=this,t=this._options.session;qq.Session&&null!=this._options.session.endpoint&&(this._session||(qq.extend(t,{cors:this._options.cors}),t.log=qq.bind(this.log,this),t.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(t)),setTimeout((function(){e._session.refresh().then((function(t,n){e._sessionRequestComplete(),e._options.callbacks.onSessionRequestComplete(t,!0,n)}),(function(t,n){e._options.callbacks.onSessionRequestComplete(t,!1,n)}))}),0))},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e){var t=this._uploadData.retrieve({id:e});return!!(!this._preventRetries[e]&&this._options.retry.enableAuto&&t.status!==qq.status.PAUSED&&(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts))&&(this._autoRetries[e]+=1,!0)},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;(t=qq.supportedFeatures.ajaxUploading?this._handler.getFile(e).qqButtonId:this._getButtonId(this._handler.getInput(e)))&&(this._buttonIdsForFileIds[e]=t)},_updateFormSupportAndParams:function(e){this._options.form.element=e,this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(e,t,n){var o=this.getName(e);t&&this.setParams(t,e),n&&this.setEndpoint(n,e),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,o),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,o),onFailure:qq.bind(this._fileOrBlobRejected,this,e,o),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qq.status.QUEUED)},_uploadStoredFiles:function(){for(var e,t,n=this;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e);(t=this.getUploads({status:qq.status.SUBMITTING}).length)&&(qq.log("Still waiting for "+t+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout((function(){n._uploadStoredFiles()}),1e3))},_validateFileOrBlobData:function(e,t){var n=this,o=e.file instanceof qq.BlobProxy?e.file.referenceBlob:e.file,i=t.name,r=t.size,a=this._getButtonId(e.file),s=this._getValidationBase(a),u=new qq.Promise;return u.then((function(){}),(function(){n._fileOrBlobRejected(e.id,i)})),qq.isFileOrInput(o)&&!this._isAllowedExtension(s.allowedExtensions,i)?(this._itemError("typeError",i,o),u.failure()):this._options.validation.allowEmpty||0!==r?r>0&&s.sizeLimit&&r>s.sizeLimit?(this._itemError("sizeError",i,o),u.failure()):r>0&&r<s.minSizeLimit?(this._itemError("minSizeError",i,o),u.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(o)?new qq.ImageValidation(o,qq.bind(n.log,n)).validate(s.image).then(u.success,(function(e){n._itemError(e+"ImageError",i,o),u.failure()})):u.success(),u):(this._itemError("emptyError",i,o),u.failure())},_wrapCallbacks:function(){var e,t,n;for(n in e=this,t=function(t,n,o){var i;try{return n.apply(e,o)}catch(n){i=n.message||n.toString(),e.log("Caught exception in '"+t+"' callback - "+i,"error")}},this._options.callbacks)!function(){var o,i;o=n,i=e._options.callbacks[o],e._options.callbacks[o]=function(){return t(o,i,arguments)}}()}}}(),function(){"use strict";qq.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,warnBeforeUnload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",omitDefaultParams:!1,params:{},paramsInBody:!0,requireSuccessJson:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n,o){},onAllComplete:function(e,t){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,o){},onResume:function(e,t,n,o){},onProgress:function(e,t,n,o){},onTotalProgress:function(e,t){},onError:function(e,t,n,o){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){},onStatusChange:function(e,t,n){},onSessionRequestComplete:function(e,t,n){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:function(e){return 2e6},success:{endpoint:null,headers:function(e){return null},jsonPayload:!1,method:"POST",params:function(e){return null},resetOnStatus:[]}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"},customKeys:function(e){return[]}},formatFileName:function(e){return e},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["KB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},qq.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._options.warnBeforeUnload&&this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),(function(e){var n=t._uploadData.retrieve({id:e});return n&&n.size||0}))),this._currentItemLimit=this._options.validation.itemLimit,this._customResumeDataStore=this._createStore()},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(e){"use strict";var t,n,o=[],i={},r={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onProgress:null};if(qq.extend(r,e),t=r.log,qq.indexOf(r.validMethods,r.method)<0)throw new Error("'"+r.method+"' is not a supported method for this type of request!");function a(e){return r.cors.expected&&void 0===e.withCredentials}function s(e,t){var n=i[e]&&i[e].xhr;return n||(n=t||(r.cors.expected?function(){var e;return(window.XMLHttpRequest||window.ActiveXObject)&&void 0===(e=qq.createXhrInstance()).withCredentials&&((e=new XDomainRequest).onload=function(){},e.onerror=function(){},e.ontimeout=function(){},e.onprogress=function(){}),e}():qq.createXhrInstance()),i[e].xhr=n),n}function u(e){var t=qq.indexOf(o,e),n=r.maxConnections;delete i[e],o.splice(t,1),o.length>=n&&t<n&&c(o[n-1])}function l(e,n){var o,i=s(e),l=r.method,c=!0===n;u(e),c?t(l+" request for "+e+" has failed","error"):a(i)||(o=i.status,qq.indexOf(r.successfulResponseCodes[r.method],o)>=0)||(c=!0,t(l+" request for "+e+" has failed - response code "+i.status,"error")),r.onComplete(e,i,c)}function c(e,o){var u,c=s(e,o),d=r.method,p=function(e){var t,n=i[e].additionalParams,o=r.mandatedParams;return r.paramsStore.get&&(t=r.paramsStore.get(e)),n&&qq.each(n,(function(e,n){(t=t||{})[e]=n})),o&&qq.each(o,(function(e,n){(t=t||{})[e]=n})),t}(e),f=i[e].payload;return r.onSend(e),u=function(e,t,o){var a=r.endpointStore.get(e),s=i[e].addToPath;null!=s&&(a+="/"+s);n&&t&&(a=qq.obj2url(t,a));o&&(a=qq.obj2url(o,a));return a}(e,p,i[e].additionalQueryParams),a(c)?(c.onload=function(e){return function(){l(e)}}(e),c.onerror=function(e){return function(){l(e,!0)}}(e)):c.onreadystatechange=function(e){return function(){4===s(e).readyState&&l(e)}}(e),function(e){var t=r.onProgress;t&&(s(e).upload.onprogress=function(n){n.lengthComputable&&t(e,n.loaded,n.total)})}(e),c.open(d,u,!0),r.cors.expected&&r.cors.sendCredentials&&!a(c)&&(c.withCredentials=!0),function(e){var t=s(e),n=r.customHeaders,o=i[e].additionalHeaders||{},u=r.method,l={};a(t)||(r.acceptHeader&&t.setRequestHeader("Accept",r.acceptHeader),r.allowXRequestedWithAndCacheControl&&(r.cors.expected&&qq.indexOf(["GET","POST","HEAD"],r.method)>=0&&(c=!1,qq.each(c,(function(e,t){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],t)<0)return c=!0,!1})),!c)||(t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("Cache-Control","no-cache"))),!r.contentType||"POST"!==u&&"PUT"!==u||t.setRequestHeader("Content-Type",r.contentType),qq.extend(l,qq.isFunction(n)?n(e):n),qq.extend(l,o),qq.each(l,(function(e,n){t.setRequestHeader(e,n)})));var c}(e),t("Sending "+d+" request for "+e),f?c.send(f):n||!p?c.send():p&&r.contentType&&r.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?c.send(qq.obj2url(p,"")):p&&r.contentType&&r.contentType.toLowerCase().indexOf("application/json")>=0?c.send(JSON.stringify(p)):c.send(p),c}n="GET"===r.method||"DELETE"===r.method,qq.extend(this,{initTransport:function(e){var t,n,a,s,u,l;return{withPath:function(e){return t=e,this},withParams:function(e){return n=e,this},withQueryParams:function(e){return l=e,this},withHeaders:function(e){return a=e,this},withPayload:function(e){return s=e,this},withCacheBuster:function(){return u=!0,this},send:function(d){return u&&qq.indexOf(["GET","DELETE"],r.method)>=0&&(n.qqtimestamp=(new Date).getTime()),function(e,t,n,a,s,u,l){if(i[e]={addToPath:n,additionalParams:a,additionalQueryParams:s,additionalHeaders:u,payload:l},o.push(e)<=r.maxConnections)return c(e,t)}(e,d,t,n,l,a,s)}}},canceled:function(e){u(e)}})},qq.UploadHandler=function(e){"use strict";var t=e.proxy,n={},o=t.onCancel,i=t.getName;qq.extend(this,{add:function(e,t){n[e]=t,n[e].temp={}},cancel:function(e){var t=this,r=new qq.Promise;o(e,i(e),r).then((function(){t.isValid(e)&&(n[e].canceled=!0,t.expunge(e)),r.success()}))},expunge:function(e){delete n[e]},getThirdPartyFileId:function(e){return n[e].key},isValid:function(e){return void 0!==n[e]},reset:function(){n={}},_getFileState:function(e){return n[e]},_setThirdPartyFileId:function(e,t){n[e].key=t},_wasCanceled:function(e){return!!n[e].canceled}})},qq.UploadHandlerController=function(e,t){"use strict";var n,o,i,r,a=this,s=!1,u=!1,l={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(e,t){},onProgress:function(e,t,n,o){},onComplete:function(e,t,n,o){},onCancel:function(e,t){},onUploadPrep:function(e){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,o){},onAutoRetry:function(e,t,n,o){},onResume:function(e,t,n,o){},onUuidChanged:function(e,t){},getName:function(e){},setSize:function(e,t){},isQueued:function(e){},getIdsInProxyGroup:function(e){},getIdsInBatch:function(e){},isInProgress:function(e){}},c={done:function(e,t,n,o){var r=i._getChunkData(e,t);i._getFileState(e).attemptingResume=!1,delete i._getFileState(e).temp.chunkProgress[t],i._getFileState(e).loaded+=r.size,l.onUploadChunkSuccess(e,i._getChunkDataForCallback(r),n,o)},finalize:function(e){var t=l.getSize(e),n=l.getName(e);o("All chunks have been uploaded for "+e+" - finalizing...."),i.finalizeChunks(e).then((function(r,a){o("Finalize successful for "+e);var s=f.normalizeResponse(r,!0);l.onProgress(e,n,t,t),i._maybeDeletePersistedChunkData(e),f.cleanup(e,s,a)}),(function(t,i){var r=f.normalizeResponse(t,!1);o("Problem finalizing chunks for file ID "+e+" - "+r.error,"error"),(r.reset||i&&l.chunking.success.resetOnStatus.indexOf(i.status)>=0)&&c.reset(e),l.onAutoRetry(e,n,r,i)||f.cleanup(e,r,i)}))},handleFailure:function(e,t,n,r){var a=l.getName(t);o("Chunked upload request failed for "+t+", chunk "+e),i.clearCachedChunk(t,e);var s,p=f.normalizeResponse(n,!1);if(p.reset)c.reset(t);else{var h=i._getFileState(t).chunking.inProgress;(s=h?qq.indexOf(h,e):-1)>=0&&(i._getFileState(t).chunking.inProgress.splice(s,1),i._getFileState(t).chunking.remaining.unshift(e))}i._getFileState(t).temp.ignoreFailure||(u&&(i._getFileState(t).temp.ignoreFailure=!0,o(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(i._getXhrs(t))),JSON.stringify(i._getFileState(t).chunking.inProgress))),qq.each(i._getXhrs(t),(function(e,n){o(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",t,e,n.readyState)),n.abort(),n._cancelled=!0})),i.moveInProgressToRemaining(t),d.free(t,!0)),l.onAutoRetry(t,a,p,r)||f.cleanup(t,p,r))},hasMoreParts:function(e){return!!i._getFileState(e).chunking.remaining.length},nextPart:function(e){var t=i._getFileState(e).chunking.remaining.shift();return t>=i._getTotalChunks(e)&&(t=null),t},reset:function(e){o("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+e,"error"),i._maybeDeletePersistedChunkData(e),i.reevaluateChunking(e),i._getFileState(e).loaded=0,i._getFileState(e).attemptingResume=!1},sendNext:function(e){var t=l.getSize(e),n=l.getName(e),r=c.nextPart(e),a=i._getChunkData(e,r),s=i._getFileState(e),p=s.attemptingResume,h=s.chunking.inProgress||[];(null==s.loaded&&(s.loaded=0),p&&!1===l.onResume(e,n,a,s.customResumeData)&&(c.reset(e),r=c.nextPart(e),a=i._getChunkData(e,r),p=!1),null==r&&0===h.length)?c.finalize(e):(h.push(r),i._getFileState(e).chunking.inProgress=h,u&&d.open(e,r),u&&d.available()&&i._getFileState(e).chunking.remaining.length&&c.sendNext(e),0===a.blob.size&&(o(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",r,e),"error"),c.handleFailure(r,e,"File is no longer available",null)),l.onUploadChunk(e,n,i._getChunkDataForCallback(a)).then((function(n){if(l.isInProgress(e)){o(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",e,r,a.start+1,a.end,t));var s={chunkIdx:r,id:e,overrides:n,resuming:p};i.uploadChunk(s).then((function(t,n){o("Chunked upload request succeeded for "+e+", chunk "+r),i.clearCachedChunk(e,r);var a=i._getFileState(e).chunking.inProgress||[],s=f.normalizeResponse(t,!0),u=qq.indexOf(a,r);o(qq.format("Chunk {} for file {} uploaded successfully.",r,e)),c.done(e,r,s,n),u>=0&&a.splice(u,1),i._maybePersistChunkedState(e),c.hasMoreParts(e)||0!==a.length?c.hasMoreParts(e)?c.sendNext(e):o(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",e,JSON.stringify(a))):c.finalize(e)}),(function(t,n){c.handleFailure(r,e,t,n)})).done((function(){i.clearXhr(e,r)}))}else o(qq.format("Not sending chunked upload request for item {}.{} - no longer in progress.",e,r))}),(function(t){c.handleFailure(r,e,t,null)})))}},d={_open:[],_openChunks:{},_waiting:[],available:function(){var e=l.maxConnections,t=0,n=0;return qq.each(d._openChunks,(function(e,o){t++,n+=o.length})),e-(d._open.length-t+n)},free:function(e,t){var n,r=!t,a=qq.indexOf(d._waiting,e),s=qq.indexOf(d._open,e);delete d._openChunks[e],f.getProxyOrBlob(e)instanceof qq.BlobProxy&&(o("Generated blob upload has ended for "+e+", disposing generated blob."),delete i._getFileState(e).file),a>=0?d._waiting.splice(a,1):r&&s>=0&&(d._open.splice(s,1),(n=d._waiting.shift())>=0&&(d._open.push(n),f.start(n)))},getWaitingOrConnected:function(){var e=[];return qq.each(d._openChunks,(function(t,n){n&&n.length&&e.push(parseInt(t))})),qq.each(d._open,(function(t,n){d._openChunks[n]||e.push(parseInt(n))})),e=e.concat(d._waiting)},isUsingConnection:function(e){return qq.indexOf(d._open,e)>=0},open:function(e,t){return null==t&&d._waiting.push(e),!!d.available()&&(null==t?(d._waiting.pop(),d._open.push(e)):((n=d._openChunks[e]||[]).push(t),d._openChunks[e]=n),!0);var n},reset:function(){d._waiting=[],d._open=[]}},p=function(e,t){var n=i._getFileState(e);n?(n.loaded=0,o("Sending simple upload request for "+e),i.uploadFile(e).then((function(n,i){o("Simple upload request succeeded for "+e);var r=f.normalizeResponse(n,!0),a=l.getSize(e);l.onProgress(e,t,a,a),f.maybeNewUuid(e,r),f.cleanup(e,r,i)}),(function(n,i){o("Simple upload request failed for "+e);var r=f.normalizeResponse(n,!1);l.onAutoRetry(e,t,r,i)||f.cleanup(e,r,i)}))):o("Ignoring send request as this upload may have been cancelled, File ID "+e,"warn")},f={cancel:function(e){o("Cancelling "+e),l.paramsStore.remove(e),d.free(e)},cleanup:function(e,t,n){var o=l.getName(e);l.onComplete(e,o,t,n),i._getFileState(e)&&i._clearXhrs&&i._clearXhrs(e),d.free(e)},getProxyOrBlob:function(e){return i.getProxy&&i.getProxy(e)||i.getFile&&i.getFile(e)},initHandler:function(){var e=t?qq[t]:qq.traditional,n=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";(i=new e[n+"UploadHandler"](l,{getCustomResumeData:l.getCustomResumeData,getDataByUuid:l.getDataByUuid,getName:l.getName,getSize:l.getSize,getUuid:l.getUuid,log:o,onCancel:l.onCancel,onProgress:l.onProgress,onUuidChanged:l.onUuidChanged,onFinalizing:function(e){l.setStatus(e,qq.status.UPLOAD_FINALIZING)}}))._removeExpiredChunkingRecords&&i._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(e){return l.isQueued(e)},maybeDefer:function(e,t){return t&&!i.getFile(e)&&t instanceof qq.BlobProxy?(l.onUploadPrep(e),o("Attempting to generate a blob on-demand for "+e),t.create().then((function(t){o("Generated an on-demand blob for "+e),i.updateBlob(e,t),l.setSize(e,t.size),i.reevaluateChunking(e),f.maybeSendDeferredFiles(e)}),(function(t){var i={};t&&(i.error=t),o(qq.format("Failed to generate blob for ID {}.  Error message: {}.",e,t),"error"),l.onComplete(e,l.getName(e),qq.extend(i,n),null),f.maybeSendDeferredFiles(e),d.free(e)})),!1):f.maybeSendDeferredFiles(e)},maybeSendDeferredFiles:function(e){var t=l.getIdsInProxyGroup(e),n=!1;return t&&t.length?(o("Maybe ready to upload proxy group file "+e),qq.each(t,(function(t,o){if(f.isDeferredEligibleForUpload(o)&&i.getFile(o))n=o===e,f.now(o);else if(f.isDeferredEligibleForUpload(o))return!1}))):(n=!0,f.now(e)),n},maybeNewUuid:function(e,t){void 0!==t.newUuid&&l.onUuidChanged(e,t.newUuid)},normalizeResponse:function(e,t){var n=e;return qq.isObject(e)||(n={},qq.isString(e)&&!t&&(n.error=e)),n.success=t,n},now:function(e){var t=l.getName(e);if(!a.isValid(e))throw new qq.Error(e+" is not a valid file ID to upload!");l.onUpload(e,t).then((function(n){n&&n.pause?(l.setStatus(e,qq.status.PAUSED),i.pause(e),d.free(e)):s&&i._shouldChunkThisFile(e)?c.sendNext(e):p(e,t)}),(function(n){if(o(e+" upload start aborted due to rejected onUpload Promise - details: "+(n=n||{}),"error"),!l.onAutoRetry(e,t,n.responseJSON||{})){var i=f.normalizeResponse(n.responseJSON,!1);f.cleanup(e,i)}}))},start:function(e){var t=f.getProxyOrBlob(e);return t?f.maybeDefer(e,t):(f.now(e),!0)}};qq.extend(this,{add:function(e,t){i.add.apply(this,arguments)},upload:function(e){return!!d.open(e)&&f.start(e)},retry:function(e){return u&&(i._getFileState(e).temp.ignoreFailure=!1),d.isUsingConnection(e)?f.start(e):a.upload(e)},cancel:function(e){var t=i.cancel(e);qq.isGenericPromise(t)?t.then((function(){f.cancel(e)})):!1!==t&&f.cancel(e)},cancelAll:function(){var e,t=d.getWaitingOrConnected();if(t.length)for(e=t.length-1;e>=0;e--)a.cancel(t[e]);d.reset()},getFile:function(e){return i.getProxy&&i.getProxy(e)?i.getProxy(e).referenceBlob:i.getFile&&i.getFile(e)},isProxied:function(e){return!(!i.getProxy||!i.getProxy(e))},getInput:function(e){if(i.getInput)return i.getInput(e)},reset:function(){o("Resetting upload handler"),a.cancelAll(),d.reset(),i.reset()},expunge:function(e){if(a.isValid(e))return i.expunge(e)},isValid:function(e){return i.isValid(e)},hasResumeRecord:function(e){var t=i.isValid(e)&&i._getLocalStorageId&&i._getLocalStorageId(e);return!!t&&!!localStorage.getItem(t)},getResumableFilesData:function(){return i.getResumableFilesData?i.getResumableFilesData():[]},getThirdPartyFileId:function(e){if(a.isValid(e))return i.getThirdPartyFileId(e)},pause:function(e){return!!(a.isResumable(e)&&i.pause&&a.isValid(e)&&i.pause(e))&&(d.free(e),i.moveInProgressToRemaining(e),!0)},isAttemptingResume:function(e){return!!i.isAttemptingResume&&i.isAttemptingResume(e)},isResumable:function(e){return!!i.isResumable&&i.isResumable(e)}}),qq.extend(l,e),o=l.log,s=l.chunking.enabled&&qq.supportedFeatures.chunking,u=s&&l.chunking.concurrent.enabled,(r={})[l.preventRetryParam]=!0,n=r,f.initHandler()},qq.WindowReceiveMessage=function(e){"use strict";var t={};qq.extend({log:function(e,t){}},e),qq.extend(this,{receiveMessage:function(e,n){window.postMessage?t[e]=qq(window).attach("message",(function(e){n(e.data)})):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(e){if(window.postMessage){var n=t[e];n&&n()}}})},qq.FormUploadHandler=function(e){"use strict";var t=e.options,n=this,o=e.proxy,i=qq.getUniqueId(),r={},a={},s={},u=t.isCors,l=t.inputName,c=o.getUuid,d=o.log,p=new qq.WindowReceiveMessage({log:d});function f(e){return e.split("_")[0]}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,(function(e){return{add:function(t,n){e.add(t,{input:n}),n.setAttribute("name",l),n.parentNode&&qq(n).remove()},expunge:function(t){!function(e){delete a[e],u&&(clearTimeout(s[e]),delete s[e],p.stopReceivingMessages(e));var t=document.getElementById(n._getIframeName(e));t&&(t.setAttribute("src","javascript:false;"),qq(t).remove())}(t),e.expunge(t)},isValid:function(t){return e.isValid(t)&&void 0!==n._getFileState(t).input}}})),qq.extend(this,{getInput:function(e){return n._getFileState(e).input},_attachLoadEvent:function(e,t){var o;u?function(e,t){var o=e.id,i=f(o),u=c(i);r[u]=t,a[i]=qq(e).attach("load",(function(){n.getInput(i)&&(d("Received iframe load event for CORS upload request (iframe name "+o+")"),s[o]=setTimeout((function(){var e="No valid message received from loaded iframe for iframe name "+o;d(e,"error"),t({error:e})}),1e3))})),p.receiveMessage(o,(function(e){d("Received the following window message: '"+e+"'");f(o);var t,i=n._parseJsonResponse(e),a=i.uuid;a&&r[a]?(d("Handling response for iframe name "+o),clearTimeout(s[o]),delete s[o],n._detachLoadEvent(o),t=r[a],delete r[a],p.stopReceivingMessages(o),t(i)):a||d("'"+e+"' does not contain a UUID - ignoring.")}))}(e,t):a[e.id]=qq(e).attach("load",(function(){if(d("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return}catch(e){d("Error when attempting to access iframe during handling of upload response ("+e.message+")","error"),o={success:!1}}t(o)}}))},_createIframe:function(e){return function(e){var t=qq.toElement("<iframe src='javascript:false;' name='"+e+"' />");return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t}(n._getIframeName(e))},_detachLoadEvent:function(e){void 0!==a[e]&&(a[e](),delete a[e])},_getIframeName:function(e){return e+"_"+i},_initFormForUpload:function(e){var t=e.method,n=e.endpoint,o=e.params,i=e.paramsInBody,r=e.targetName,a=qq.toElement("<form method='"+t+"' enctype='multipart/form-data'></form>"),s=n;return i?qq.obj2Inputs(o,a):s=qq.obj2url(o,n),a.setAttribute("action",s),a.setAttribute("target",r),a.style.display="none",document.body.appendChild(a),a},_parseJsonResponse:function(e){var t={};try{t=qq.parseJson(e)}catch(e){d("Error when attempting to parse iframe upload response ("+e.message+")","error")}return t}})},qq.XhrUploadHandler=function(e){"use strict";var t=this,n=e.options.namespace,o=e.proxy,i=e.options.chunking,r=function(e){var n=t._getFileState(e);if(n.chunkSize)return n.chunkSize;var o=i.partSize;return qq.isFunction(o)&&(o=o(e,c(e))),n.chunkSize=o,o},a=e.options.resume,s=i&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,u=a&&e.options.resume.enabled&&s&&qq.supportedFeatures.resume,l=o.getName,c=o.getSize,d=o.getUuid,p=o.getEndpoint,f=o.getDataByUuid,h=o.onUuidChanged,m=o.onProgress,q=o.log,g=o.getCustomResumeData;function _(e){qq.each(t._getXhrs(e),(function(n,o){var i=t._getAjaxRequester(e,n);o.onreadystatechange=null,o.upload.onprogress=null,o.abort(),i&&i.canceled&&i.canceled(e)}))}qq.extend(this,new qq.UploadHandler(e)),qq.override(this,(function(e){return{add:function(n,o){if(qq.isFile(o)||qq.isBlob(o))e.add(n,{file:o});else{if(!(o instanceof qq.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");e.add(n,{proxy:o})}t._initTempState(n),u&&t._maybePrepareForResume(n)},expunge:function(n){_(n),t._maybeDeletePersistedChunkData(n),t._clearXhrs(n),e.expunge(n)}}})),qq.extend(this,{clearCachedChunk:function(e,n){var o=t._getFileState(e);o&&delete o.temp.cachedChunks[n]},clearXhr:function(e,n){var o=t._getFileState(e).temp;o.xhrs&&delete o.xhrs[n],o.ajaxRequesters&&delete o.ajaxRequesters[n]},finalizeChunks:function(e,n){var o=t._getTotalChunks(e)-1,i=t._getXhr(e,o);return n?(new qq.Promise).success(n(i),i):(new qq.Promise).success({},i)},getFile:function(e){return t.isValid(e)&&t._getFileState(e).file},getProxy:function(e){return t.isValid(e)&&t._getFileState(e).proxy},getResumableFilesData:function(){var e=[];return t._iterateResumeRecords((function(n,o){t.moveInProgressToRemaining(null,o.chunking.inProgress,o.chunking.remaining);var i={name:o.name,remaining:o.chunking.remaining,size:o.size,uuid:o.uuid};o.key&&(i.key=o.key),o.customResumeData&&(i.customResumeData=o.customResumeData),e.push(i)})),e},isAttemptingResume:function(e){return t._getFileState(e).attemptingResume},isResumable:function(e){return!!i&&t.isValid(e)&&!t._getFileState(e).notResumable},moveInProgressToRemaining:function(e,n,o){var i=(t._getFileState(e)||{}).chunking||{},r=n||i.inProgress,a=o||i.remaining;r&&(q(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(r))),r.reverse(),qq.each(r,(function(e,t){a.unshift(t)})),r.length=0)},pause:function(e){if(t.isValid(e))return q(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,l(e))),t._getFileState(e).paused=!0,_(e),!0},reevaluateChunking:function(e){if(i&&t.isValid(e)){var n,o,r=t._getFileState(e);if(delete r.chunking,r.chunking={},(n=t._getTotalChunks(e))>1||i.mandatory){for(r.chunking.enabled=!0,r.chunking.parts=n,r.chunking.remaining=[],o=0;o<n;o++)r.chunking.remaining.push(o);t._initTempState(e)}else r.chunking.enabled=!1}},updateBlob:function(e,n){t.isValid(e)&&(t._getFileState(e).file=n)},_clearXhrs:function(e){var n=t._getFileState(e).temp;qq.each(n.ajaxRequesters,(function(e){delete n.ajaxRequesters[e]})),qq.each(n.xhrs,(function(e){delete n.xhrs[e]}))},_createXhr:function(e,n){return t._registerXhr(e,n,qq.createXhrInstance())},_getAjaxRequester:function(e,n){var o=null==n?-1:n;return t._getFileState(e).temp.ajaxRequesters[o]},_getChunkData:function(e,n){var o=r(e),i=c(e),a=t.getFile(e),s=o*n,u=s+o>=i?i:s+o,l=t._getTotalChunks(e),d=this._getFileState(e).temp.cachedChunks,p=d[n]||qq.sliceBlob(a,s,u);return d[n]=p,{part:n,start:s,end:u,count:l,blob:p,size:u-s}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getLocalStorageId:function(e){var t=l(e),o=c(e),i=r(e),s=p(e),u=a.customKeys(e),d=qq.format("qq{}resume{}-{}-{}-{}-{}",n,"5.0",t,o,i,s);return u.forEach((function(e){d+="-"+e})),d},_getMimeType:function(e){return t.getFile(e).type},_getPersistableData:function(e){return t._getFileState(e).chunking},_getTotalChunks:function(e){if(i){var t=c(e),n=r(e);return Math.ceil(t/n)}},_getXhr:function(e,n){var o=null==n?-1:n;return t._getFileState(e).temp.xhrs[o]},_getXhrs:function(e){return t._getFileState(e).temp.xhrs},_iterateResumeRecords:function(e){u&&qq.each(localStorage,(function(t,o){if(0===t.indexOf(qq.format("qq{}resume",n))){var i=JSON.parse(o);e(t,i)}}))},_initTempState:function(e){t._getFileState(e).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(e){t._getFileState(e).notResumable=!0},_maybeDeletePersistedChunkData:function(e){var n;return!!(u&&t.isResumable(e)&&(n=t._getLocalStorageId(e))&&localStorage.getItem(n))&&(localStorage.removeItem(n),!0)},_maybePrepareForResume:function(e){var n,o,i=t._getFileState(e);u&&void 0===i.key&&(n=t._getLocalStorageId(e),(o=localStorage.getItem(n))&&(o=JSON.parse(o),f(o.uuid)?t._markNotResumable(e):(q(qq.format("Identified file with ID {} and name of {} as resumable.",e,l(e))),h(e,o.uuid),i.key=o.key,i.chunking=o.chunking,i.loaded=o.loaded,i.customResumeData=o.customResumeData,i.attemptingResume=!0,t.moveInProgressToRemaining(e))))},_maybePersistChunkedState:function(e){var n,o,i=t._getFileState(e);if(u&&t.isResumable(e)){var r=g(e);n=t._getLocalStorageId(e),o={name:l(e),size:c(e),uuid:d(e),key:i.key,chunking:i.chunking,loaded:i.loaded,lastUpdated:Date.now()},r&&(o.customResumeData=r);try{localStorage.setItem(n,JSON.stringify(o))}catch(t){q(qq.format("Unable to save resume data for '{}' due to error: '{}'.",e,t.toString()),"warn")}}},_registerProgressHandler:function(e,n,o){var i=t._getXhr(e,n),r=l(e),a={simple:function(t,n){var o=c(e);m(e,r,t===n?o:t>=o?o-1:t,o)},chunked:function(i,a){var s=t._getFileState(e).temp.chunkProgress,u=t._getFileState(e).loaded,l=i,d=a,p=c(e),f=l-(d-o),h=u;s[n]=f,qq.each(s,(function(e,t){h+=t})),m(e,r,h,p)}};i.upload.onprogress=function(e){e.lengthComputable&&a[null==o?"simple":"chunked"](e.loaded,e.total)}},_registerXhr:function(e,n,o,i){var r=null==n?-1:n,a=t._getFileState(e).temp;return a.xhrs=a.xhrs||{},a.ajaxRequesters=a.ajaxRequesters||{},a.xhrs[r]=o,i&&(a.ajaxRequesters[r]=i),o},_removeExpiredChunkingRecords:function(){var e=a.recordsExpireIn;t._iterateResumeRecords((function(t,n){var o=new Date(n.lastUpdated);o.setDate(o.getDate()+e),o.getTime()<=Date.now()&&(q("Removing expired resume record with key "+t),localStorage.removeItem(t))}))},_shouldChunkThisFile:function(e){var n=t._getFileState(e);if(n)return n.chunking||t.reevaluateChunking(e),n.chunking.enabled}})},qq.DeleteFileAjaxRequester=function(e){"use strict";var t,n={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(e){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,n){}};qq.extend(n,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:"POST"===n.method.toUpperCase()?{_method:"DELETE"}:{},maxConnections:n.maxConnections,customHeaders:function(e){return n.customHeaders.get(e)},log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors})),qq.extend(this,{sendDelete:function(e,o,i){var r=i||{};n.log("Submitting delete file request for "+e),"DELETE"===n.method?t.initTransport(e).withPath(o).withParams(r).send():(r[n.uuidParamName]=o,t.initTransport(e).withParams(r).send())}})},function(){function e(e,n,o,i,r){var a,s=e.naturalWidth,u=e.naturalHeight,l=i.width,c=i.height,d=o.getContext("2d"),p=new qq.Promise;return d.save(),i.resize?function(e){var n=e.blob,o=e.image,i=e.imageHeight,r=e.imageWidth,a=e.orientation,s=new qq.Promise,u=e.resize,l=document.createElement("canvas"),c=l.getContext("2d"),d=e.canvas,p=e.targetHeight,f=e.targetWidth;return t(l,r,i,a),d.height=p,d.width=f,c.drawImage(o,0,0),u({blob:n,height:p,image:o,sourceCanvas:l,targetCanvas:d,width:f}).then((function(){d.qqImageRendered&&d.qqImageRendered(),s.success()}),s.failure),s}({blob:n,canvas:o,image:e,imageHeight:u,imageWidth:s,orientation:i.orientation,resize:i.resize,targetHeight:c,targetWidth:l}):(qq.supportedFeatures.unlimitedScaledImageSize||(a=function(e){if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(e.origHeight*e.origWidth>5241e3)return{newHeight:Math.round(Math.sqrt(e.origHeight/e.origWidth*5241e3)),newWidth:Math.round(Math.sqrt(e.origWidth/e.origHeight*5241e3))}}({origWidth:l,origHeight:c}))&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",l,c,a.newWidth,a.newHeight),"warn"),l=a.newWidth,c=a.newHeight),t(o,l,c,i.orientation),qq.ios()?function(){(function(e){var t,n=e.naturalWidth,o=e.naturalHeight,i=document.createElement("canvas");return n*o>1048576&&(i.width=i.height=1,(t=i.getContext("2d")).drawImage(e,1-n,0),0===t.getImageData(0,0,1,1).data[3])})(e)&&(s/=2,u/=2);var t,n,o,i=1024,a=document.createElement("canvas"),p=r?function(e,t,n){var o,i,r,a=document.createElement("canvas"),s=0,u=n,l=n;for(a.width=1,a.height=n,(o=a.getContext("2d")).drawImage(e,0,0),i=o.getImageData(0,0,1,n).data;l>s;)0===i[4*(l-1)+3]?u=l:s=l,l=u+s>>1;return 0===(r=l/n)?1:r}(e,0,u):1,f=Math.ceil(i*l/s),h=Math.ceil(i*c/u/p),m=0,q=0;for(a.width=a.height=i,t=a.getContext("2d");m<u;){for(n=0,o=0;n<s;)t.clearRect(0,0,i,i),t.drawImage(e,-n,-m),d.drawImage(a,0,0,i,i,o,q,f,h),n+=i,o+=f;m+=i,q+=h}d.restore(),a=t=null}():d.drawImage(e,0,0,l,c),o.qqImageRendered&&o.qqImageRendered(),p.success(),p)}function t(e,t,n,o){switch(o){case 5:case 6:case 7:case 8:e.width=n,e.height=t;break;default:e.width=t,e.height=n}var i=e.getContext("2d");switch(o){case 2:i.translate(t,0),i.scale(-1,1);break;case 3:i.translate(t,n),i.rotate(Math.PI);break;case 4:i.translate(0,n),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-n);break;case 7:i.rotate(.5*Math.PI),i.translate(t,-n),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-t,0)}}function n(e,t){var n=this;window.Blob&&e instanceof Blob&&function(){var t=new Image,o=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!o)throw Error("No createObjectURL function found to create blob url");t.src=o.createObjectURL(e),n.blob=e,e=t}(),e.naturalWidth||e.naturalHeight||(e.onload=function(){var e=n.imageLoadListeners;e&&(n.imageLoadListeners=null,setTimeout((function(){for(var t=0,n=e.length;t<n;t++)e[t]()}),0))},e.onerror=t,this.imageLoadListeners=[]),this.srcImage=e}n.prototype.render=function(t,n){n=n||{};var o,i,r=this,a=this.srcImage.naturalWidth,s=this.srcImage.naturalHeight,u=n.width,l=n.height,c=n.maxWidth,d=n.maxHeight,p=!this.blob||"image/jpeg"===this.blob.type,f=t.tagName.toLowerCase();this.imageLoadListeners?this.imageLoadListeners.push((function(){r.render(t,n)})):(u&&!l?l=s*u/a<<0:l&&!u?u=a*l/s<<0:(u=a,l=s),c&&u>c&&(l=s*(u=c)/a<<0),d&&l>d&&(u=a*(l=d)/s<<0),o={width:u,height:l},qq.each(n,(function(e,t){o[e]=t})),"img"===f?(i=t.src,function(t,n,o,i){var r=document.createElement("canvas"),a=o.mime||"image/jpeg",s=new qq.Promise;return e(t,n,r,o,i).then((function(){s.success(r.toDataURL(a,o.quality||.8))})),s}(r.srcImage,r.blob,o,p).then((function(e){t.src=e,i===t.src&&t.onload&&t.onload()}))):"canvas"===f&&e(this.srcImage,this.blob,t,o,p),"function"==typeof this.onrender&&this.onrender(t))},qq.MegaPixImage=n}(),qq.ImageGenerator=function(e){"use strict";function t(e){return"img"===e.tagName.toLowerCase()}function n(e){return"canvas"===e.tagName.toLowerCase()}function o(e){var t=e.split("/"),n=t[t.length-1].split("?")[0],o=qq.getExtension(n);switch(o=o&&o.toLowerCase()){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function i(e){var t,n,o,i=document.createElement("a");return i.href=e,t=i.protocol,o=i.port,n=i.hostname,t.toLowerCase()!==window.location.protocol.toLowerCase()||(n.toLowerCase()!==window.location.hostname.toLowerCase()||o!==window.location.port&&!qq.ie())}function r(o,i){var r=t(o)||n(o);return t(o)?function(t,n){t.onload=function(){t.onload=null,t.onerror=null,n.success(t)},t.onerror=function(){t.onload=null,t.onerror=null,e("Problem drawing thumbnail!","error"),n.failure(t,"Problem drawing thumbnail!")}}(o,i):n(o)?function(e,t){e.qqImageRendered=function(){t.success(e)}}(o,i):(i.failure(o),e(qq.format("Element container of type {} is not supported!",o.tagName),"error")),r}function a(e,t,n,a,s){var u=new Image,l=new qq.Promise;r(u,l),i(e)&&(u.crossOrigin="anonymous"),u.src=e,l.then((function(){r(t,n),new qq.MegaPixImage(u).render(t,{maxWidth:a,maxHeight:a,mime:o(e),resize:s})}),n.failure)}function s(e,t,n,o){r(t,n),qq(t).css({maxWidth:o+"px",maxHeight:o+"px"}),t.src=e}function u(e,o,u){var l,c=new qq.Promise,d=u.scale,p=d?u.maxSize:null;return d&&t(o)?(l=document.createElement("canvas")).getContext&&l.getContext("2d")?i(e)&&void 0===(new Image).crossOrigin?s(e,o,c,p):a(e,o,c,p):s(e,o,c,p):n(o)?a(e,o,c,p):r(o,c)&&(o.src=e),c}qq.extend(this,{generate:function(t,n,o){return qq.isString(t)?(e("Attempting to update thumbnail based on server response."),u(t,n,o||{})):(e("Attempting to draw client-side image preview."),function(t,n,o){var i=new qq.Promise,a=new qq.Identify(t,e),s=o.maxSize,u=null==o.orient||o.orient,l=function(){n.onerror=null,n.onload=null,e("Could not render preview, file may be too large!","error"),i.failure(n,"Browser cannot render image!")};return a.isPreviewable().then((function(a){var c={parse:function(){return(new qq.Promise).success()}},d=u?new qq.Exif(t,e):c,p=new qq.MegaPixImage(t,l);r(n,i)&&d.parse().then((function(e){var t=e&&e.Orientation;p.render(n,{maxWidth:s,maxHeight:s,orientation:t,mime:a,resize:o.customResizeFunction})}),(function(t){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",t)),p.render(n,{maxWidth:s,maxHeight:s,mime:a,resize:o.customResizeFunction})}))}),(function(){e("Not previewable"),i.failure(n,"Not previewable")})),i}(t,n,o||{}))}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=n,this._testing.isCrossOrigin=i,this._testing.determineMimeOfFileName=o},qq.Exif=function(e,t){"use strict";var n=[274],o={274:{name:"Orientation",bytes:2}};function i(e){for(var t=0,n=0;e.length>0;)t+=parseInt(e.substring(0,2),16)*Math.pow(2,n),e=e.substring(2,e.length),n+=8;return t}function r(){var t=new qq.Promise;return qq.readBlobToHex(e,0,6).then((function(n){0!==n.indexOf("ffd8")?t.failure("Not a valid JPEG!"):function t(n,o){var i=n,r=o;return void 0===i&&(i=2,r=new qq.Promise),qq.readBlobToHex(e,i,4).then((function(e){var n,o=/^ffe([0-9])/.exec(e);o?"1"!==o[1]?(n=parseInt(e.slice(4,8),16),t(i+n+2,r)):r.success(i):r.failure("No EXIF header to be found!")})),r}().then((function(e){t.success(e)}),(function(e){t.failure(e)}))})),t}qq.extend(this,{parse:function(){var a=new qq.Promise,s=function(e){t(qq.format("EXIF header parse failed: '{}' ",e)),a.failure(e)};return r().then((function(r){var u,l;t(qq.format("Moving forward with EXIF header parsing for '{}'",void 0===e.name?"blob":e.name)),(u=r,l=new qq.Promise,qq.readBlobToHex(e,u+10,2).then((function(e){l.success("4949"===e)})),l).then((function(u){t(qq.format("EXIF Byte order is {} endian",u?"little":"big")),function(t,n){var o=new qq.Promise;return qq.readBlobToHex(e,t+18,2).then((function(e){if(n)return o.success(i(e));o.success(parseInt(e,16))})),o}(r,u).then((function(l){t(qq.format("Found {} APP1 directory entries",l)),function(t,n){var o=t+20,i=12*n;return qq.readBlobToHex(e,o,i)}(r,l).then((function(e){var r=function(e){for(var t=[],n=0;n+24<=e.length;)t.push(e.slice(n,n+24)),n+=24;return t}(e),s=function(e,t){var r=qq.extend([],n),a={};return qq.each(t,(function(t,n){var s,u,l,c=n.slice(0,4),d=e?i(c):parseInt(c,16),p=r.indexOf(d);if(p>=0&&(u=o[d].name,l=o[d].bytes,s=n.slice(16,16+2*l),a[u]=e?i(s):parseInt(s,16),r.splice(p,1)),0===r.length)return!1})),a}(u,r);t("Successfully parsed some EXIF tags"),a.success(s)}),s)}),s)}),s)}),s),a}}),this._testing={},this._testing.parseLittleEndian=i},qq.Identify=function(e,t){"use strict";qq.extend(this,{isPreviewable:function(){var n=this,o=new qq.Promise,i=!1,r=void 0===e.name?"blob":e.name;return t(qq.format("Attempting to determine if {} can be rendered in this browser",r)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qq.readBlobToHex(e,0,4).then((function(e){qq.each(n.PREVIEWABLE_MIME_TYPES,(function(t,n){if(r=e,a=!1,s=[].concat(n),qq.each(s,(function(e,t){if(0===r.indexOf(t))return a=!0,!1})),a)return("image/tiff"!==t||qq.supportedFeatures.tiffPreviews)&&(i=!0,o.success(t)),!1;var r,a,s})),t(qq.format("'{}' is {} able to be rendered in this browser",r,i?"":"NOT")),i||o.failure()}),(function(){t("Error reading file w/ name '"+r+"'.  Not able to be rendered in this browser."),o.failure()}))):o.failure(),o},isPreviewableSync:function(){var n=e.type,o=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),n)>=0,i=!1,r=void 0===e.name?"blob":e.name;return o&&(i="image/tiff"!==n||qq.supportedFeatures.tiffPreviews),!i&&t(r+" is not previewable in this browser per the blob's type attr"),i}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(e,t){"use strict";this.validate=function(n){var o,i=new qq.Promise;return t("Attempting to validate image."),!function(e){var t=!1;return qq.each(e,(function(e,n){if(n>0)return t=!0,!1})),t}(n)?i.success():(o=new qq.Promise,new qq.Identify(e,t).isPreviewable().then((function(){var n=new Image,i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;i?(n.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),o.failure()},n.onload=function(){o.success({width:this.width,height:this.height})},n.src=i.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),o.failure())}),o.failure),o).then((function(e){var t=function(e,t){var n;return qq.each(e,(function(e,o){if(o>0){var i=/(max|min)(Width|Height)/.exec(e),r=i[2].charAt(0).toLowerCase()+i[2].slice(1),a=t[r];switch(i[1]){case"min":if(a<o)return n=e,!1;break;case"max":if(a>o)return n=e,!1}}})),n}(n,e);t?i.failure(t):i.success()}),i.success),i}},qq.Session=function(e){"use strict";var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(e){},log:function(e,t){}};function n(e,n,o,i){var r=!1;(n=n&&function(e){if(qq.isArray(e))return!0;t.log("Session response is not an array.","error")}(e))&&qq.each(e,(function(e,n){if(null==n.uuid)r=!0,t.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",e),"error");else if(null==n.name)r=!0,t.log(qq.format("Session response item {} did not include a valid name - ignoring.",e),"error");else try{return t.addFileRecord(n),!0}catch(e){r=!0,t.log(e.message,"error")}return!1})),i[n&&!r?"success":"failure"](e,o)}qq.extend(t,e,!0),this.refresh=function(){var e=new qq.Promise,o=qq.extend({},t);return new qq.SessionAjaxRequester(qq.extend(o,{onComplete:function(t,o,i){n(t,o,i,e)}})).queryServer(),e}},qq.SessionAjaxRequester=function(e){"use strict";var t,n={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(e,t,n){},log:function(e,t){}};qq.extend(n,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:function(e,t,o){var i=null;if(null!=t.responseText)try{i=qq.parseJson(t.responseText)}catch(e){n.log("Problem parsing session response: "+e.message,"error"),o=!0}n.onComplete(i,!o,t)},cors:n.cors})),qq.extend(this,{queryServer:function(){var e=qq.extend({},n.params);n.log("Session query request."),t.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})},qq.Scaler=function(e,t){"use strict";var n=e.customResizer,o=e.sendOriginal,i=e.orient,r=e.defaultType,a=e.defaultQuality/100,s=e.failureText,u=e.includeExif,l=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&l.length>0,getFileRecords:function(e,c,d){var p=this,f=[],h=d.blob?d.blob:d;return new qq.Identify(h,t).isPreviewableSync()?(qq.each(l,(function(e,o){var l=p._determineOutputType({defaultType:r,requestedType:o.type,refType:h.type});f.push({uuid:qq.getUniqueId(),name:p._getName(c,{name:o.name,type:l,refType:h.type}),blob:new qq.BlobProxy(h,qq.bind(p._generateScaledImage,p,{customResizeFunction:n,maxSize:o.maxSize,orient:i,type:l,quality:a,failedText:s,includeExif:u,log:t}))})})),f.push({uuid:e,name:c,size:h.size,blob:o?h:null})):f.push({uuid:e,name:c,size:h.size,blob:h}),f},handleNewFile:function(e,t,n,o,i,r,a,s){e.qqButtonId||e.blob&&e.blob.qqButtonId;var u,l=[],c=null,d=s.addFileToHandler,p=s.uploadData,f=s.paramsStore,h=qq.getUniqueId();qq.each(this.getFileRecords(n,t,e),(function(e,t){var n,o=t.size;t.blob instanceof qq.BlobProxy&&(o=-1),n=p.addFile({uuid:t.uuid,name:t.name,size:o,batchId:r,proxyGroupId:h}),t.blob instanceof qq.BlobProxy?l.push(n):c=n,t.blob?(d(n,t.blob),i.push({id:n,file:t.blob})):p.setStatus(n,qq.status.REJECTED)})),null!==c&&(qq.each(l,(function(e,t){var n={qqparentuuid:p.retrieve({id:c}).uuid,qqparentsize:p.retrieve({id:c}).size};n[a]=p.retrieve({id:t}).uuid,p.setParentId(t,c),f.addReadOnly(t,n)})),l.length&&((u={})[a]=p.retrieve({id:c}).uuid,f.addReadOnly(c,u)))}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){"use strict";if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var o=new qq.Promise,i=n.log,r=n.getFile(e),a=n.uploadData.retrieve({id:e}),s=a&&a.name,u=a&&a.uuid,l={customResizer:t.customResizer,sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},c=new qq.Scaler(l,i);return qq.Scaler&&qq.supportedFeatures.imagePreviews&&r?qq.bind((function(){var t=c.getFileRecords(u,s,r)[0];t&&t.blob instanceof qq.BlobProxy?t.blob.create().then(o.success,o.failure):(i(e+" is not a scalable image!","error"),o.failure())}),this)():(o.failure(),i("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")),o},_determineOutputType:function(e){"use strict";var t=e.requestedType,n=e.defaultType,o=e.refType;return n||t?t&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?"image/tiff"===t?qq.supportedFeatures.tiffPreviews?t:n:t:n:"image/jpeg"!==o?"image/png":o},_getName:function(e,t){"use strict";var n=e.lastIndexOf("."),o=t.type||"image/png",i=t.refType,r="",a=qq.getExtension(e),s="";return t.name&&t.name.trim().length&&(s=" ("+t.name+")"),n>=0?(r=e.substr(0,n),i!==o&&(a=o.split("/")[1]),r+=s+"."+a):r=e+s,r},_getSortedSizes:function(e){"use strict";return(e=qq.extend([],e)).sort((function(e,t){return e.maxSize>t.maxSize?1:e.maxSize<t.maxSize?-1:0}))},_generateScaledImage:function(e,t){"use strict";var n=this,o=e.customResizeFunction,i=e.log,r=e.maxSize,a=e.orient,s=e.type,u=e.quality,l=e.failedText,c=e.includeExif&&"image/jpeg"===t.type&&"image/jpeg"===s,d=new qq.Promise,p=new qq.ImageGenerator(i),f=document.createElement("canvas");return i("Attempting to generate scaled version for "+t.name),p.generate(t,f,{maxSize:r,orient:a,customResizeFunction:o}).then((function(){var e=f.toDataURL(s,u),o=function(){i("Success generating scaled version for "+t.name);var n=qq.dataUriToBlob(e);d.success(n)};c?n._insertExifHeader(t,e,i).then((function(t){e=t,o()}),(function(){i("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),o()})):o()}),(function(){i("Failed attempt to generate scaled version for "+t.name,"error"),d.failure(l)})),d},_insertExifHeader:function(e,t,n){"use strict";var o=new FileReader,i=new qq.Promise,r="";return o.onload=function(){r=o.result,i.success(qq.ExifRestorer.restore(r,t))},o.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),i.failure()},o.readAsDataURL(e),i},_dataUriToBlob:function(e){"use strict";var t,n,o,i;return t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(t.length),i=new Uint8Array(o),qq.each(t,(function(e,t){i[e]=t.charCodeAt(0)})),this._createBlob(o,n)},_createBlob:function(e,t){"use strict";var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,o=n&&new n;return o?(o.append(e),o.getBlob(t)):new Blob([e],{type:t})}}),qq.ExifRestorer=(ExifRestorer={KEY_STR:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(e){var t,n,o,i,r,a="",s="",u="",l=0;do{o=(t=e[l++])>>2,i=(3&t)<<4|(n=e[l++])>>4,r=(15&n)<<2|(s=e[l++])>>6,u=63&s,isNaN(n)?r=u=64:isNaN(s)&&(u=64),a=a+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(u),t=n=s="",o=i=r=u=""}while(l<e.length);return a},restore:function(e,t){if(!e.match("data:image/jpeg;base64,"))return t;var n=this.decode64(e.replace("data:image/jpeg;base64,","")),o=this.slice2Segments(n),i=this.exifManipulation(t,o);return"data:image/jpeg;base64,"+this.encode64(i)},exifManipulation:function(e,t){var n=this.getExifArray(t),o=this.insertExif(e,n);return new Uint8Array(o)},getExifArray:function(e){for(var t,n=0;n<e.length;n++)if(255==(t=e[n])[0]&225==t[1])return t;return[]},insertExif:function(e,t){var n=e.replace("data:image/jpeg;base64,",""),o=this.decode64(n),i=o.indexOf(255,3),r=o.slice(0,i),a=o.slice(i),s=r;return s=(s=s.concat(t)).concat(a)},slice2Segments:function(e){for(var t=0,n=[];!(255==e[t]&218==e[t+1]);){if(255==e[t]&216==e[t+1])t+=2;else{var o=t+(256*e[t+2]+e[t+3])+2,i=e.slice(t,o);n.push(i),t=o}if(t>e.length)break}return n},decode64:function(e){var t,n,o,i,r="",a="",s=0,u=[];if(/[^A-Za-z0-9\+\/\=]/g.exec(e))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=this.KEY_STR.indexOf(e.charAt(s++))<<2|(o=this.KEY_STR.indexOf(e.charAt(s++)))>>4,n=(15&o)<<4|(i=this.KEY_STR.indexOf(e.charAt(s++)))>>2,r=(3&i)<<6|(a=this.KEY_STR.indexOf(e.charAt(s++))),u.push(t),64!=i&&u.push(n),64!=a&&u.push(r),t=n=r="",o=i=a=""}while(s<e.length);return u}},ExifRestorer),qq.TotalProgress=function(e,t){"use strict";var n={},o=0,i=0,r=-1,a=-1,s=function(t,n){t===r&&n===a||e(t,n),r=t,a=n},u=function(e){var o=t(e);o>0&&(l(e,0,o),n[e]={loaded:0,total:o})},l=function(e,t,r){var a=n[e]?n[e].loaded:0,u=n[e]?n[e].total:0;-1===t&&-1===r?(o-=a,i-=u):(t&&(o+=t-a),r&&(i+=r-u)),s(o,i)};qq.extend(this,{onAllComplete:function(e,t,n){(0===t.length||function(e,t){var n=!0;return qq.each(e,(function(e,o){if(qq.indexOf(t,o)>=0)return n=!1,!1})),n}(t,n))&&(s(i,i),this.reset())},onStatusChange:function(e,t,o){o===qq.status.CANCELED||o===qq.status.REJECTED?function(e){l(e,-1,-1),delete n[e]}(e):o===qq.status.SUBMITTING&&u(e)},onIndividualProgress:function(e,t,o){l(e,t,o),n[e]={loaded:t,total:o}},onNewSize:function(e){u(e)},reset:function(){n={},o=0,i=0}})},qq.PasteSupport=function(e){"use strict";var t,n;t={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}},qq.extend(t,e),n=qq(t.targetElement).attach("paste",(function(e){var n=e.clipboardData;n&&qq.each(n.items,(function(e,n){if(function(e){return e.type&&0===e.type.indexOf("image/")}(n)){var o=n.getAsFile();t.callbacks.pasteReceived(o)}}))})),qq.extend(this,{reset:function(){n&&n()}})},qq.FormSupport=function(e,t,n){"use strict";var o=this,i=e.interceptSubmit,r=e.element,a=e.autoUpload;function s(e,t){if(!e.checkValidity||e.checkValidity())return!0;n("Form did not pass validation checks - will not upload.","error"),t()}qq.extend(this,{newEndpoint:null,newAutoUpload:a,attachedToForm:!1,getFormInputsAsObject:function(){return null==r?null:o._form2Obj(r)}}),r=function(e){return e&&(qq.isString(e)&&(e=document.getElementById(e)),e&&(n("Attaching to form element."),function(e){e.getAttribute("action")&&(o.newEndpoint=e.getAttribute("action"))}(e),i&&function(e){var n=e.submit;qq(e).attach("submit",(function(o){(o=o||window.event).preventDefault?o.preventDefault():o.returnValue=!1,s(e,n)&&t()})),e.submit=function(){s(e,n)&&t()}}(e))),e}(r),this.attachedToForm=!!r},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){"use strict";var t={},n=function(e){return t=e.type,qq.indexOf(["checkbox","radio"],t.toLowerCase())>=0&&!e.checked||e.disabled&&"hidden"!==e.type.toLowerCase();var t};return qq.each(e.elements,(function(e,o){if((qq.isInput(o,!0)||"textarea"===o.tagName.toLowerCase())&&(r=o.type,qq.indexOf(["button","image","reset","submit"],r.toLowerCase())<0)&&!n(o))t[o.name]=o.value;else if("select"===o.tagName.toLowerCase()&&!n(o)){var i=function(e){var t=null;return qq.each(qq(e).children(),(function(e,n){if("option"===n.tagName.toLowerCase()&&n.selected)return t=n.value,!1})),t}(o);null!==i&&(t[o.name]=i)}var r})),t}}),qq.traditional=qq.traditional||{},qq.traditional.FormUploadHandler=function(e,t){"use strict";var n=this,o=t.getName,i=t.getUuid,r=t.log;this.uploadFile=function(t){var a,s=n.getInput(t),u=n._createIframe(t),l=new qq.Promise;return(a=function(t,r){var a=e.paramsStore.get(t),s="get"===e.method.toLowerCase()?"GET":"POST",u=e.endpointStore.get(t),l=o(t);return a[e.uuidName]=i(t),a[e.filenameParam]=l,n._initFormForUpload({method:s,endpoint:u,params:a,paramsInBody:e.paramsInBody,targetName:r.name})}(t,u)).appendChild(s),n._attachLoadEvent(u,(function(o){r("iframe loaded");var i=o||function(e,t){var o,i,a;try{a=(i=t.contentDocument||t.contentWindow.document).body.innerHTML,r("converting iframe's innerHTML to JSON"),r("innerHTML = "+a),a&&a.match(/^<pre/i)&&(a=i.body.firstChild.firstChild.nodeValue),o=n._parseJsonResponse(a)}catch(e){r("Error when attempting to parse form upload response ("+e.message+")","error"),o={success:!1}}return o}(0,u);n._detachLoadEvent(t),e.cors.expected||qq(u).remove(),i.success?l.success(i):l.failure(i)})),r("Sending upload request for "+t),a.submit(),qq(a).remove(),l},qq.extend(this,new qq.FormUploadHandler({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,getName:o,getUuid:i,log:r}}))},qq.traditional=qq.traditional||{},qq.traditional.XhrUploadHandler=function(e,t){"use strict";var n=this,o=t.getName,i=t.getSize,r=t.getUuid,a=t.log,s=e.forceMultipart||e.paramsInBody,u=new qq.traditional.AllChunksDoneAjaxRequester({cors:e.cors,endpoint:e.chunking.success.endpoint,headers:e.chunking.success.headers,jsonPayload:e.chunking.success.jsonPayload,log:a,method:e.chunking.success.method,params:e.chunking.success.params}),l=function(e,t){var n=new qq.Promise;return t.onreadystatechange=function(){if(4===t.readyState){var o=d(e,t);o.success?n.success(o.response,t):n.failure(o.response,t)}},n},c=function(t,n){return qq.indexOf([200,201,202,203,204],t.status)<0||e.requireSuccessJson&&!n.success||n.reset},d=function(e,t){var n;return a("xhr - server response received for "+e),a("responseText = "+t.responseText),n=p(!0,t),{success:!c(t,n),response:n}},p=function(t,n){var o={};try{a(qq.format("Received response status {} with body: {}",n.status,n.responseText)),o=qq.parseJson(n.responseText)}catch(n){t&&e.requireSuccessJson&&a("Error when attempting to parse xhr response text ("+n.message+")","error")}return o},f=function(t){var a=new qq.Promise;return u.complete(t,n._createXhr(t),function(t){var a=e.paramsStore.get(t),s=o(t),u=i(t);return a[e.uuidName]=r(t),a[e.filenameParam]=s,a[e.totalFileSizeName]=u,a[e.chunking.paramNames.totalParts]=n._getTotalChunks(t),a}(t),e.customHeaders.get(t)).then((function(e){a.success(p(!1,e),e)}),(function(e){a.failure(p(!1,e),e)})),a},h=function(t){var n,a=t.fileOrBlob,u=t.id,l=t.xhr,c=t.xhrOverrides||{},d=t.customParams||{},p=t.params||{},f=c.params||{},h=s?new FormData:null,m=c.method||e.method,q=c.endpoint||e.endpointStore.get(u),g=o(u),_=i(u);return e.omitDefaultParams?(n=qq.extend({},d),qq.extend(n,f)):(n=qq.extend({},d),qq.extend(n,f),qq.extend(n,p),n[e.uuidName]=r(u),n[e.filenameParam]=g,s?n[e.totalFileSizeName]=_:e.paramsInBody||(n[e.inputName]=g)),e.paramsInBody||(q=qq.obj2url(n,q)),l.open(m,q,!0),e.cors.expected&&e.cors.sendCredentials&&(l.withCredentials=!0),s?(e.paramsInBody&&qq.obj2FormData(n,h),h.append(e.inputName,a),h):a},m=function(t){var o=t.headerOverrides,i=t.id,r=t.xhr;if(o)qq.each(o,(function(e,t){r.setRequestHeader(e,t)}));else{var a=e.customHeaders.get(i),u=n.getFile(i);r.setRequestHeader("Accept","application/json"),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Cache-Control","no-cache"),s||(r.setRequestHeader("Content-Type","application/octet-stream"),r.setRequestHeader("X-Mime-Type",u.type)),qq.each(a,(function(e,t){r.setRequestHeader(e,t)}))}};qq.extend(this,{uploadChunk:function(t){var r,a,u,c=t.id,d=t.chunkIdx,p=t.overrides||{},f=t.resuming,q=n._getChunkData(c,d),g=n._createXhr(c,d),_={};return r=l(c,g),n._registerProgressHandler(c,d,q.size),u=e.paramsStore.get(c),function(t,n,r){var a=i(t),u=o(t);e.omitDefaultParams||(n[e.chunking.paramNames.partIndex]=r.part,n[e.chunking.paramNames.partByteOffset]=r.start,n[e.chunking.paramNames.chunkSize]=r.size,n[e.chunking.paramNames.totalParts]=r.count,n[e.totalFileSizeName]=a),s&&!e.omitDefaultParams&&(n[e.filenameParam]=u)}(c,_,q),f&&(_[e.resume.paramNames.resuming]=!0),a=h({fileOrBlob:q.blob,id:c,customParams:u,params:_,xhr:g,xhrOverrides:p}),m({headerOverrides:p.headers,id:c,xhr:g}),g.send(a),r},uploadFile:function(t){var o,i,r,a,s=n.getFile(t);return i=n._createXhr(t),n._registerProgressHandler(t),o=l(t,i),r=e.paramsStore.get(t),a=h({fileOrBlob:s,id:t,customParams:r,xhr:i}),m({id:t,xhr:i}),i.send(a),o}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,(function(n){return{finalizeChunks:function(o){return t.onFinalizing(o),e.chunking.success.endpoint?f(o):n.finalizeChunks(o,qq.bind(p,this,!0))}}}))},qq.traditional.AllChunksDoneAjaxRequester=function(e){"use strict";var t,n={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(e,t){},method:"POST"},o={},i={get:function(e){return qq.isFunction(n.endpoint)?n.endpoint(e):n.endpoint}};qq.extend(n,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",contentType:n.jsonPayload?"application/json":"application/x-www-form-urlencoded",validMethods:[n.method],method:n.method,endpointStore:i,allowXRequestedWithAndCacheControl:!1,cors:n.cors,log:n.log,onComplete:function(e,t,n){var i=o[e];delete o[e],n?i.failure(t):i.success(t)}})),qq.extend(this,{complete:function(e,i,r,a){var s=new qq.Promise;return n.log("Submitting All Chunks Done request for "+e),o[e]=s,t.initTransport(e).withParams(n.params(e)||r).withHeaders(n.headers(e)||a).send(i),s}})}}(window)},function(e,t,n){var o=n(4),i=/[\/\+\.]/;e.exports=function(e,t){function n(t){var n=o(t,e,i);return n&&n.length>=2}return t?n(t.split(";")[0]):n}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;!function(global){var qq=function e(t){"use strict";return{hide:function(){return t.style.display="none",this},attach:function(n,o){return t.addEventListener?t.addEventListener(n,o,!1):t.attachEvent&&t.attachEvent("on"+n,o),function(){e(t).detach(n,o)}},detach:function(e,n){return t.removeEventListener?t.removeEventListener(e,n,!1):t.attachEvent&&t.detachEvent("on"+e,n),this},contains:function(e){return!!e&&(t===e||(t.contains?t.contains(e):!!(8&e.compareDocumentPosition(t))))},insertBefore:function(e){return e.parentNode.insertBefore(t,e),this},remove:function(){return t.parentNode.removeChild(t),this},css:function(n){if(null==t.style)throw new e.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=n.opacity&&"string"!=typeof t.style.opacity&&void 0!==t.filters&&(n.filter="alpha(opacity="+Math.round(100*n.opacity)+")"),e.extend(t.style,n),this},hasClass:function(e,n){var o=new RegExp("(^| )"+e+"( |$)");return o.test(t.className)||!(!n||!o.test(t.parentNode.className))},addClass:function(n){return e(t).hasClass(n)||(t.className+=" "+n),this},removeClass:function(e){var n=new RegExp("(^| )"+e+"( |$)");return t.className=t.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(n,o){var i,r=[];return o&&t.querySelector?t.querySelector("."+n):t.querySelectorAll?t.querySelectorAll("."+n):(i=t.getElementsByTagName("*"),e.each(i,(function(t,o){e(o).hasClass(n)&&r.push(o)})),o?r[0]:r)},getFirstByClass:function(n){return e(t).getByClass(n,!0)},children:function(){for(var e=[],n=t.firstChild;n;)1===n.nodeType&&e.push(n),n=n.nextSibling;return e},setText:function(e){return t.innerText=e,t.textContent=e,this},clearText:function(){return e(t).setText("")},hasAttribute:function(e){var n;return t.hasAttribute?!!t.hasAttribute(e)&&null==/^false$/i.exec(t.getAttribute(e)):void 0!==(n=t[e])&&null==/^false$/i.exec(n)}}};!function(){"use strict";var div;qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,o,i,r,a,s,u;return n=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),o=new Uint8Array(t),qq.each(n,(function(e,t){o[e]=t.charCodeAt(0)})),r=t,a=i,s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,(u=s&&new s)?(u.append(r),u.getBlob(a)):new Blob([r],{type:a})},qq.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},qq.isObject=function(e){return e&&!e.nodeType&&"[object Object]"===Object.prototype.toString.call(e)},qq.isFunction=function(e){return"function"==typeof e},qq.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return"[object DataTransferItemList]"===Object.prototype.toString.call(e)},qq.isNodeList=function(e){return"[object NodeList]"===Object.prototype.toString.call(e)||e.item&&e.namedItem},qq.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,o=n.indexOf("{}");return qq.each(t,(function(e,t){var i=n.substring(0,o),r=n.substring(o+2);if((o=(n=i+t+r).indexOf("{}",o+t.length))<0)return!1})),n},qq.isFile=function(e){return window.File&&"[object File]"===Object.prototype.toString.call(e)},qq.isFileList=function(e){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(e)},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(e){var n=e.toLowerCase();return t?"file"!==n:"file"===n};return!!(window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(e)&&e.type&&n(e.type))||!!(e.tagName&&"input"===e.tagName.toLowerCase()&&e.type&&n(e.type))},qq.isBlob=function(e){if(window.Blob&&"[object Blob]"===Object.prototype.toString.call(e))return!0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",void 0!==e.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&void 0!==qq.createXhrInstance().upload},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qq.sliceBlob=function(e,t,n){return(e.slice||e.mozSlice||e.webkitSlice).call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,(function(e,n){var o=n.toString(16);o.length<2&&(o="0"+o),t+=o})),t},qq.readBlobToHex=function(e,t,n){var o=qq.sliceBlob(e,t,t+n),i=new FileReader,r=new qq.Promise;return i.onload=function(){r.success(qq.arrayBufferToHex(i.result))},i.onerror=r.failure,i.readAsArrayBuffer(o),r},qq.extend=function(e,t,n){return qq.each(t,(function(t,o){n&&qq.isObject(o)?(void 0===e[t]&&(e[t]={}),qq.extend(e[t],o,!0)):e[t]=o})),e},qq.override=function(e,t){var n={},o=t(n);return qq.each(o,(function(t,o){void 0!==e[t]&&(n[t]=e[t]),e[t]=o})),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var o=e.length;for(n<0&&(n+=o);n<o;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},qq.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")},qq.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")},qq.ie8=function(){return-1!==navigator.userAgent.indexOf("MSIE 8")},qq.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},qq.ie11=function(){return qq.ie()&&-1!==navigator.userAgent.indexOf("rv:11")},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){return"Win32"===navigator.platform},qq.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0&&navigator.userAgent.toLowerCase().indexOf("firefox")<0},qq.ios6=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 6_")},qq.ios7=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")},qq.ios8=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_")},qq.ios800=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_0 ")},qq.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qq.iosChrome=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf("CriOS")},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&-1!==navigator.userAgent.indexOf("Safari")},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=(div=document.createElement("div"),function(e){div.innerHTML=e;var t=div.firstChild;return div.removeChild(t),t}),qq.each=function(e,t){var n;if(e)if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length&&!1!==t(e.key(n),e.getItem(e.key(n)));n++);else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length&&!1!==t(n,e[n]);n++);else if(qq.isString(e))for(n=0;n<e.length&&!1!==t(n,e.charAt(n));n++);else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&!1===t(n,e[n]))break},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var o=qq.extend([],n);return arguments.length&&(o=o.concat(Array.prototype.slice.call(arguments))),e.apply(t,o)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var o=[],i="&",r=function(e,n){var i=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;"undefined"!==i&&"undefined"!==n&&o.push("object"==typeof e?qq.obj2url(e,i,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(i)+"="+encodeURIComponent(e()):encodeURIComponent(i)+"="+encodeURIComponent(e))};return!n&&t?(i=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",o.push(t),o.push(qq.obj2url(e))):"[object Array]"===Object.prototype.toString.call(e)&&void 0!==e?qq.each(e,(function(e,t){r(t,e)})):null!=e&&"object"==typeof e?qq.each(e,(function(e,t){r(t,e)})):o.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?o.join(i):o.join(i).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,(function(e,o){e=n?n+"["+e+"]":e,qq.isObject(o)?qq.obj2FormData(o,t,e):qq.isFunction(o)?t.append(e,o()):t.append(e,o)})),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(e,o){(n=document.createElement("input")).setAttribute("name",e),n.setAttribute("value",o),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do{(t=e.shift())&&t()}while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}}(),function(){"use strict";void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return qq}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}(),qq.version="6.0.2",qq.supportedFeatures=function(){"use strict";var e,t,n,o,i,r,a,s,u,l,c,d,p,f,h,m,q;function g(){return!!window.XMLHttpRequest&&void 0!==qq.createXhrInstance().withCredentials}function _(){return void 0!==window.XDomainRequest}return e=function(){var e,t=!0;try{(e=document.createElement("input")).type="file",qq(e).hide(),e.disabled&&(t=!1)}catch(e){t=!1}return t}(),t=(o=e&&qq.isXhrUploadSupported())&&!qq.androidStock(),i=(n=o&&(("draggable"in(m=document.createElement("span"))||"ondragstart"in m&&"ondrop"in m)&&!qq.android()&&!qq.ios()))&&((q=document.createElement("input")).type="file",!!("webkitdirectory"in(q||document.querySelectorAll("input[type=file]")[0]))),r=o&&qq.isFileChunkingSupported(),a=o&&r&&function(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch(e){return!1}}(),s=o&&(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/),u=e&&(void 0!==window.postMessage||o),c=g(),l=_(),d=!!g()||_(),p=void 0!==document.createElement("input").webkitdirectory,f=o&&void 0!==window.FileReader,h=!!o&&!qq.androidStock()&&!qq.iosChrome(),{ajaxUploading:o,blobUploading:t,canDetermineSize:o,chunking:r,deleteFileCors:d,deleteFileCorsXdr:l,deleteFileCorsXhr:c,dialogElement:!!window.HTMLDialogElement,fileDrop:n,folderDrop:i,folderSelection:p,imagePreviews:f,imageValidation:f,itemSizeValidation:o,pause:r,progressBar:h,resume:a,scaling:f&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:u,uploadCustomHeaders:o,uploadNonMultipart:o,uploadViaPaste:s}}(),qq.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){"use strict";var e,t,n=[],o=[],i=[],r=0;qq.extend(this,{then:function(i,a){return 0===r?(i&&n.push(i),a&&o.push(a)):-1===r?a&&a.apply(null,t):i&&i.apply(null,e),this},done:function(n){return 0===r?i.push(n):n.apply(null,void 0===t?e:t),this},success:function(){return r=1,e=arguments,n.length&&qq.each(n,(function(t,n){n.apply(null,e)})),i.length&&qq.each(i,(function(t,n){n.apply(null,e)})),this},failure:function(){return r=-1,t=arguments,o.length&&qq.each(o,(function(e,n){n.apply(null,t)})),i.length&&qq.each(i,(function(e,n){n.apply(null,t)})),this}})},qq.DragAndDrop=function(e){"use strict";var t,n,o,i="qq-hidezones",r="qq-hide-dropzone",a=[],s=[],u=new qq.DisposeSupport;function l(e){var n=new qq.Promise;return e.isFile?e.file((function(t){t.qqPath=c(e),s.push(t),n.success()}),(function(o){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+o.code+".","error"),n.failure()})):e.isDirectory&&function e(t,n,o,i){var r=i||new qq.Promise,a=n||t.createReader();a.readEntries((function(n){var i=o?o.concat(n):n;n.length?setTimeout((function(){e(t,a,i,r)}),0):r.success(i)}),r.failure);return r}(e).then((function(e){var t=e.length;qq.each(e,(function(e,o){l(o).done((function(){0===(t-=1)&&n.success()}))})),e.length||n.success()}),(function(o){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+o.code+".","error"),n.failure()})),n}function c(e){var t=e.name,n=e.fullPath,o=n.lastIndexOf(t);return"/"===(n=n.substr(0,o)).charAt(0)&&(n=n.substr(1)),n}function d(e){var n=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:i,element:e,onEnter:function(n){qq(e).addClass(t.classes.dropActive),t.callbacks.dragEnter(),n.stopPropagation()},onLeaveNotDescendants:function(n){qq(e).removeClass(t.classes.dropActive),t.callbacks.dragLeave()},onDrop:function(e){var o,i,r,a;(o=e.dataTransfer,i=n,r=[],a=new qq.Promise,t.callbacks.processingDroppedFiles(),i.dropDisabled(!0),o.files.length>1&&!t.allowMultipleItems?(t.callbacks.processingDroppedFilesComplete([]),t.callbacks.dropError("tooManyFilesError",""),i.dropDisabled(!1),a.failure()):(s=[],qq.isFolderDropSupported(o)?qq.each(o.items,(function(e,t){var n=t.webkitGetAsEntry();n&&(n.isFile?s.push(t.getAsFile()):r.push(l(n).done((function(){r.pop(),0===r.length&&a.success()}))))})):s=o.files,0===r.length&&a.success()),a).then((function(){!function(e,n){var o=Array.prototype.slice.call(e);t.callbacks.dropLog("Grabbed "+e.length+" dropped files."),n.dropDisabled(!1),t.callbacks.processingDroppedFilesComplete(o,n.getElement())}(s,n)}),(function(){t.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")}))}});return u.addDisposer((function(){n.dispose()})),qq(e).hasAttribute(r)&&qq(e).hide(),a.push(n),n}function p(e){var t;return qq.each(e.dataTransfer.types,(function(e,n){if("Files"===n)return t=!0,!1})),t}t={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(t,e,!0),n=t.dropZoneElements,o=function(){setTimeout((function(){qq.each(n,(function(e,n){qq(n).hasAttribute(r)&&qq(n).hide(),qq(n).removeClass(t.classes.dropActive)}))}),10)},qq.each(n,(function(e,t){var o=d(t);n.length&&qq.supportedFeatures.fileDrop&&u.attach(document,"dragenter",(function(e){!o.dropDisabled()&&p(e)&&qq.each(n,(function(e,t){t instanceof HTMLElement&&qq(t).hasAttribute(r)&&qq(t).css({display:"block"})}))}))})),u.attach(document,"dragleave",(function(e){(function(e){return qq.safari()?e.x<0||e.y<0:0===e.x&&0===e.y})(e)&&o()})),u.attach(qq(document).children()[0],"mouseenter",(function(e){o()})),u.attach(document,"drop",(function(e){p(e)&&(e.preventDefault(),o())})),u.attach(document,i,o),qq.extend(this,{setupExtraDropzone:function(e){t.dropZoneElements.push(e),d(e)},removeDropzone:function(e){var n,o=t.dropZoneElements;for(n in o)if(o[n]===e)return o.splice(n,1)},dispose:function(){u.dispose(),qq.each(a,(function(e,t){t.dispose()}))}}),this._testing={},this._testing.extractDirectoryPath=c},qq.DragAndDrop.callbacks=function(){"use strict";return{dragEnter:function(){},dragLeave:function(){},processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}},qq.UploadDropZone=function(e){"use strict";var t,n,o,i,r=new qq.DisposeSupport;function a(){return qq.safari()||qq.firefox()&&qq.windows()}function s(e){if(!qq.supportedFeatures.fileDrop)return!1;var t,n=e.dataTransfer,o=qq.safari();return t=!(!qq.ie()||!qq.supportedFeatures.fileDrop)||"none"!==n.effectAllowed,n&&t&&(n.files&&n.files.length||!o&&n.types.contains&&n.types.contains("Files")||n.types.includes&&n.types.includes("Files"))}function u(e){return void 0!==e&&(o=e),o}t={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},qq.extend(t,e),n=t.element,i||(a?r.attach(document,"dragover",(function(e){e.preventDefault()})):r.attach(document,"dragover",(function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())})),i=!0),r.attach(n,"dragover",(function(e){if(s(e)){var t=qq.ie()&&qq.supportedFeatures.fileDrop?null:e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy",e.stopPropagation(),e.preventDefault()}})),r.attach(n,"dragenter",(function(e){if(!u()){if(!s(e))return;t.onEnter(e)}})),r.attach(n,"dragleave",(function(e){if(s(e)){t.onLeave(e);var n=document.elementFromPoint(e.clientX,e.clientY);qq(this).contains(n)||t.onLeaveNotDescendants(e)}})),r.attach(n,"drop",(function(e){if(!u()){if(!s(e))return;e.preventDefault(),e.stopPropagation(),t.onDrop(e),function(){var e;function n(){(e=document.createEvent("Event")).initEvent(t.HIDE_ZONES_EVENT_NAME,!0,!0)}if(window.CustomEvent)try{e=new CustomEvent(t.HIDE_ZONES_EVENT_NAME)}catch(e){n()}else n();document.dispatchEvent(e)}()}})),qq.extend(this,{dropDisabled:function(e){return u(e)},dispose:function(){r.dispose()},getElement:function(){return n}}),this._testing={},this._testing.isValidFileDrag=s}}(window)},function(e,t,n){"use strict";function o(e,t){this.text=e=e||"",this.hasWild=~e.indexOf("*"),this.separator=t,this.parts=e.split(t)}o.prototype.match=function(e){var t,n,o=!0,i=this.parts,r=i.length;if("string"==typeof e||e instanceof String)if(this.hasWild||this.text==e){for(n=(e||"").split(this.separator),t=0;o&&t<r;t++)"*"!==i[t]&&(o=t<n.length&&i[t]===n[t]);o=o&&n}else o=!1;else if("function"==typeof e.splice)for(o=[],t=e.length;t--;)this.match(e[t])&&(o[o.length]=e[t]);else if("object"==typeof e)for(var a in o={},e)this.match(a)&&(o[a]=e[a]);return o},e.exports=function(e,t,n){var i=new o(e,n||/[\/\.]/);return void 0!==t?i.match(t):i}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){var o={"./7z.svg":9,"./ai.svg":10,"./archive.svg":11,"./audio.svg":12,"./avi.svg":13,"./csv.svg":14,"./doc.svg":15,"./html.svg":16,"./iso.svg":17,"./json.svg":18,"./mp3.svg":19,"./mp4.svg":20,"./pdf.svg":21,"./ppt.svg":22,"./psd.svg":23,"./rar.svg":24,"./rtf.svg":25,"./svg.svg":26,"./tar.svg":27,"./txt.svg":28,"./unknown.svg":29,"./video.svg":30,"./xls.svg":31,"./xml.svg":32,"./zip.svg":33};function i(e){var t=r(e);return n(t)}function r(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}i.keys=function(){return Object.keys(o)},i.resolve=r,e.exports=i,i.id=8},function(e,t,n){e.exports=n.p+"image/7z.svg"},function(e,t,n){e.exports=n.p+"image/ai.svg"},function(e,t,n){e.exports=n.p+"image/archive.svg"},function(e,t,n){e.exports=n.p+"image/audio.svg"},function(e,t,n){e.exports=n.p+"image/avi.svg"},function(e,t,n){e.exports=n.p+"image/csv.svg"},function(e,t,n){e.exports=n.p+"image/doc.svg"},function(e,t,n){e.exports=n.p+"image/html.svg"},function(e,t,n){e.exports=n.p+"image/iso.svg"},function(e,t,n){e.exports=n.p+"image/json.svg"},function(e,t,n){e.exports=n.p+"image/mp3.svg"},function(e,t,n){e.exports=n.p+"image/mp4.svg"},function(e,t,n){e.exports=n.p+"image/pdf.svg"},function(e,t,n){e.exports=n.p+"image/ppt.svg"},function(e,t,n){e.exports=n.p+"image/psd.svg"},function(e,t,n){e.exports=n.p+"image/rar.svg"},function(e,t,n){e.exports=n.p+"image/rtf.svg"},function(e,t,n){e.exports=n.p+"image/svg.svg"},function(e,t,n){e.exports=n.p+"image/tar.svg"},function(e,t,n){e.exports=n.p+"image/txt.svg"},function(e,t,n){e.exports=n.p+"image/unknown.svg"},function(e,t,n){e.exports=n.p+"image/video.svg"},function(e,t,n){e.exports=n.p+"image/xls.svg"},function(e,t,n){e.exports=n.p+"image/xml.svg"},function(e,t,n){e.exports=n.p+"image/zip.svg"},function(e,t,n){"use strict";n.r(t);var o=n(0),i=n.n(o),r=n(1),a=n(3),s=n(2),u=n.n(s);const l=window.paperAdmin.EventEmitter;function c(){Error.apply(this,arguments),this.name="ValidationError",Error.captureStackTrace?Error.captureStackTrace(this,c):this.stack=(new Error).stack}function d(e,t){this._opts=Object.assign({url:"",multiple:!1,maxConnections:1,button:null,dropzones:null,extraData:null,validation:{},filters:[]},t),this.element=e,this.uploader=this._makeUploader()}function p(e){const t={},n=e.dataset;return Object.keys(n).forEach((function(e){/^paper(?:[^a-z0-9]|$)/.test(e)&&(t[e]=n[e])})),t}c.prototype=Object.create(Error.prototype),d.prototype=Object.create(l.prototype),d.prototype.getParams=function(){return"function"==typeof this._opts.extraData?Object.assign(p(this.element),this._opts.extraData.call(this)):"object"==typeof this._opts.extraData?Object.assign(p(this.element),this._opts.extraData):p(this.element)},d.prototype._makeUploader=function(){const e=this;let t=!1,n=new r.FineUploaderBasic({button:this._opts.button,multiple:this._opts.multiple,maxConnections:this._opts.maxConnections,request:{endpoint:this._opts.url,params:this.getParams()},chunking:{enabled:!0,partSize:2097152,concurrent:{enabled:!1}},text:{fileInputTitle:""},validation:{stopOnFirstInvalidFile:!1,sizeLimit:e._opts.validation.sizeLimit||0,acceptFiles:e._opts.validation.acceptFiles||null,allowedExtensions:e._opts.validation.allowedExtensions||[]},messages:{typeError:"`{file}` has an invalid extension. Valid extension(s): {extensions}.",sizeError:"`{file}` is too large, maximum file size is {sizeLimit}."},callbacks:{onSubmit:function(n){const o=this,i=o.getFile(n);if(t&&!e._opts.multiple)return!1;if(t=!0,e._opts.filters&&e._opts.filters.length)for(let t=0;t<e._opts.filters.length;t++){const r=e._opts.filters[t];try{r.call(o,n,i)}catch(t){return e.trigger("error",[n,t.message]),!1}}const a=e._opts.validation;if(Object(r.isFile)(i)){const t=a.acceptFiles;if(t&&t.length){let o=!1;if(Array.isArray(t)?o=t.some((function(e){return u()(i.type,e)})):"string"==typeof t&&(o=u()(i.type,t)),!o){const t=`\`${i.name}\` has an invalid mimetype '${i.type}'`;return e.trigger("error",[n,t]),!1}}if(a.image)return new Promise((function(e,t){const n=new Image,o=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;o?(n.onerror=function(){t("Cannot determine dimensions for an image. May be too large.")},n.onload=function(){e({width:this.width,height:this.height})},n.src=o.createObjectURL(i)):t("No createObjectURL function available to generate image URL!")})).then((function(t){if(a.minImageWidth&&t.width<a.minImageWidth){const t=`\`${i.name}\` is not wide enough. Minimum width is ${a.minImageWidth}px`;throw e.trigger("error",[n,t]),new Error(t)}if(a.minImageHeight&&t.height<a.minImageHeight){const t=`\`${i.name}\` is not tall enough. Minimum height is ${a.minImageHeight}px`;throw e.trigger("error",[n,t]),new Error(t)}if(a.maxImageWidth&&t.width>a.maxImageWidth){const t=`\`${i.name}\` is too wide. Maximum width is ${a.maxImageWidth}px`;throw e.trigger("error",[n,t]),new Error(t)}if(a.maxImageHeight&&t.height>a.maxImageHeight){const t=`\`${i.name}\` is too tall. Maximum height is ${a.maxImageHeight}px`;throw e.trigger("error",[n,t]),new Error(t)}}))}try{e.trigger("submit",[n])}catch(e){if("ValidationError"===e.name)return!1;throw e}},onSubmitted:function(t){e.trigger("submitted",[t])},onUpload:function(t){e.trigger("upload",[t])},onProgress:function(t,n,o,i){const r=Math.ceil(o/i*100);e.trigger("progress",[t,r])},onCancel:function(t){e.trigger("cancel",[t])},onComplete:function(t,n,o){o.success&&e.trigger("complete",[t,o])},onAllComplete:function(n,o){t=!1,e.trigger("all_complete",[n,o])},onError:function(t,n,o,i){let r,a;try{r=JSON.parse(i.responseText)}catch(e){}a=r&&(r.errors||r.error)||o,e.trigger("error",[t,a])}}});return this._opts.dropzones&&this._opts.dropzones.length&&new a.DragAndDrop({dropZoneElements:this._opts.dropzones,allowMultipleItems:this._opts.multiple,classes:{dropActive:"dropzone-highlighted"},callbacks:{processingDroppedFilesComplete:function(e){n.addFiles(e)}}}),n};const f=window.paperAdmin.bootbox;let h=[];function m(e){if(Array.isArray(e)){if(1===e.length)return e[0];{let t=["Please correct the following errors:",'<ul class="px-4 mb-0">'];for(let n=0,o=e.length;n<o;n++)t.push(`<li>${e[n]}</li>`);return t.push("</ul>"),t=t.join("\n")}}return e}function q(e){console.debug(`Show error: ${e}`),setTimeout((function(){f.alert({title:"Error",message:m(e)})}))}const g=window.paperAdmin.EventEmitter,_=window.paperAdmin.bootbox,v=window.paperAdmin.preloader,b=window.paperAdmin.formUtils;function y(e,t){if(this._opts=i()({input:"",uploadButton:"",cancelButton:"",changeButton:"",deleteButton:"",link:"",urls:{upload:"",change:"",delete:""}},t||{}),this.element=e,this.input=this.element.querySelector(this._opts.input),!this.input)throw new Error(`Not found element "${this._opts.input}"`);if(this.uploadButton=this.element.querySelector(this._opts.uploadButton),!this.uploadButton)throw new Error(`Not found element "${this._opts.uploadButton}"`);if(this.cancelButton=this.element.querySelector(this._opts.cancelButton),!this.cancelButton)throw new Error(`Not found element "${this._opts.cancelButton}"`);if(this.changeButton=this.element.querySelector(this._opts.changeButton),!this.changeButton)throw new Error(`Not found element "${this._opts.changeButton}"`);if(this.deleteButton=this.element.querySelector(this._opts.deleteButton),!this.deleteButton)throw new Error(`Not found element "${this._opts.deleteButton}"`);this.loading=!1,this.empty=isNaN(this.instanceId),this.uploader=this.initUploader(),this.addListeners()}y.prototype=Object.create(g.prototype),Object.defineProperty(y.prototype,"instanceId",{get:function(){return parseInt(this.input.value)},set:function(e){this.input.value=parseInt(e)||""}}),Object.defineProperty(y.prototype,"empty",{get:function(){return Boolean(this._empty)},set:function(e){const t=Boolean(e);t!==Boolean(this._empty)&&(t?this.element.classList.add("empty"):this.element.classList.remove("empty"),this._empty=t)}}),Object.defineProperty(y.prototype,"loading",{get:function(){return Boolean(this._loading)},set:function(e){const t=Boolean(e);t!==Boolean(this._loading)&&(t?this.element.classList.add("loading"):(this.element.classList.remove("loading"),this.element.classList.remove("processing")),this._loading=t)}}),y.prototype.initUploader=function(){const e=this;return new d(this.element,{url:this._opts.urls.upload,button:this.uploadButton,dropzones:this.element.querySelectorAll(".dropzone-overlay"),validation:JSON.parse(this.element.dataset.validation)}).on("submitted",(function(t){e.trigger("upload:submitted",[t])})).on("upload",(function(t){e.loading=!0;const n=e.element.querySelector(".progress-bar");n&&(n.style.width=""),e.trigger("upload:upload",[t])})).on("progress",(function(t,n){const o=e.element.querySelector(".progress-bar");o&&(o.style.width=n+"%"),n>=100&&e.element.classList.add("processing")})).on("complete",(function(t,n){e.empty=!1,e.instanceId=n.instance_id,e.trigger("upload:created");const o=e.element.querySelector(".file-name");o&&(o.textContent=n.name);const i=e.element.querySelector(".file-info");i&&(i.textContent=n.file_info);const r=e.element.querySelector(e._opts.link);r&&(r.href=n.url),e.trigger("upload:complete")})).on("cancel",(function(t){e.trigger("upload:cancel",[t])})).on("error",(function(e,t){q(t)})).on("all_complete",(function(){e.loading=!1}))},y.prototype._change=function(e){if(isNaN(this.instanceId))return;const t=this,n=e.find("form");Promise.all([v.show(),fetch(n.prop("action"),{method:"POST",credentials:"same-origin",body:new FormData(n.get(0))})]).then((function(e){const t=e[1];if(!t.ok){const e=new Error(`${t.status} ${t.statusText}`);throw e.response=t,e}return t.json()})).then((function(o){if(o.errors&&o.errors.length){const e=new Error("Invalid request");throw e.response=o,e}if(v.hide(),b.cleanFormErrors(n.get(0)),o.form_errors)b.addFormErrorsFromJSON(n.get(0),o.form_errors);else{e.modal("hide");const n=t.element.querySelector(".file-name");n&&(n.textContent=o.name);const i=t.element.querySelector(".file-info");i&&(i.textContent=o.file_info);const r=t.element.querySelector(t._opts.link);r&&(r.href=o.url)}})).catch((function(e){v.hide(),"object"==typeof e&&e.response&&e.response.errors?q(e.response.errors):e instanceof Error?q(e.message):q(e)}))},y.prototype._delete=function(){if(isNaN(this.instanceId))return;const e=new FormData,t=p(this.element);Object.keys(t).forEach((function(n){e.append(n,t[n])})),e.append("instance_id",this.instanceId.toString());const n=this;Promise.all([v.show(),fetch(this._opts.urls.delete,{method:"POST",credentials:"same-origin",body:e})]).then((function(e){const t=e[1];if(!t.ok){const e=new Error(`${t.status} ${t.statusText}`);throw e.response=t,e}return t.json()})).then((function(e){if(e.errors&&e.errors.length){const t=new Error("Invalid request");throw t.response=e,t}v.hide(),n.empty=!0,n.instanceId="";const t=n.element.querySelector(".file-name");t&&(t.textContent="");const o=n.element.querySelector(".file-info");o&&(o.textContent=""),n.trigger("upload:deleted")})).catch((function(e){v.hide(),"object"==typeof e&&e.response&&e.response.errors?q(e.response.errors):e instanceof Error?q(e.message):q(e)}))},y.prototype.addListeners=function(){const e=this;this.cancelButton.addEventListener("click",(function(t){t.preventDefault(),e.loading=!1,e.uploader.uploader.cancelAll()})),this.deleteButton.addEventListener("click",(function(t){t.preventDefault(),_.dialog({size:"small",title:gettext("Confirmation"),message:gettext("Are you sure you want to <b>DELETE</b> this file?"),onEscape:!0,buttons:{cancel:{label:gettext("Cancel"),className:"btn-outline-info"},confirm:{label:gettext("Delete"),className:"btn-danger",callback:function(){e._delete()}}}})})),this.changeButton.addEventListener("click",(function(t){t.preventDefault();const n=new FormData,o=p(e.element);Object.keys(o).forEach((function(e){n.append(e,o[e])})),n.append("instance_id",e.instanceId.toString());const i=new URLSearchParams(n).toString();Promise.all([v.show(),fetch(`${e._opts.urls.change}?${i}`,{credentials:"same-origin"})]).then((function(e){const t=e[1];if(!t.ok){const e=new Error(`${t.status} ${t.statusText}`);throw e.response=t,e}return t.json()})).then((function(t){if(t.errors&&t.errors.length){const e=new Error("Invalid request");throw e.response=t,e}v.hide();const n=_.dialog({title:gettext("Edit file"),message:t.form,onEscape:!0,buttons:{cancel:{label:gettext("Cancel"),className:"btn-outline-info"},ok:{label:gettext("Save"),className:"btn-success",callback:function(){return e._change(this),!1}}}});n.find("form").on("submit",(function(){return e._change(n),!1}))})).catch((function(e){v.hide(),"object"==typeof e&&e.response&&e.response.errors?q(e.response.errors):e instanceof Error?q(e.message):q(e)}))}))};n(5);const w=window.paperAdmin.whenDomReady,S=window.paperAdmin.emitters;function x(e){e.closest(".empty-form")||new y(e,{input:".file-uploader__input",uploadButton:".file-uploader__upload-button",cancelButton:".file-uploader__cancel-button",changeButton:".file-uploader__change-button",deleteButton:".file-uploader__delete-button",link:".file-uploader__link",urls:{upload:e.dataset.uploadUrl,change:e.dataset.changeUrl,delete:e.dataset.deleteUrl}})}function E(e=document.body){e.matches(".file-uploader")&&x(e),e.querySelectorAll(".file-uploader").forEach(x)}w(E),S.dom.on("mutate",E);n(6);const C=window.paperAdmin.whenDomReady,I=window.paperAdmin.emitters;function F(e){e.closest(".empty-form")||new y(e,{input:".image-uploader__input",uploadButton:".image-uploader__upload-button",cancelButton:".image-uploader__cancel-button",changeButton:".image-uploader__change-button",deleteButton:".image-uploader__delete-button",link:".image-uploader__link",urls:{upload:e.dataset.uploadUrl,change:e.dataset.changeUrl,delete:e.dataset.deleteUrl}})}function D(e=document.body){e.matches(".image-uploader")&&F(e),e.querySelectorAll(".image-uploader").forEach(F)}C(D),I.dom.on("mutate",D);n(7);const k=window.paperAdmin.EventEmitter,A=window.paperAdmin.whenDomReady,P=window.paperAdmin.Sortable,R=window.paperAdmin.bootbox,U=window.paperAdmin.emitters,O=window.paperAdmin.preloader,B=window.paperAdmin.formUtils;function T(e,t){if(this._opts=i()({input:".collection__input",itemContainer:".collection__items",item:".collection__item",createButton:".collection__create-button",uploadButton:".collection__upload-button",deleteButton:".collection__delete-button",preloaderItem:".collection__item--preloader",preloaderTemplate:".collection__item-preloader",itemPreview:".collection__item-preview",itemLink:".collection__item-link",itemCheckbox:".collection__item-checkbox",itemName:".collection__item-name",changeItemButton:".collection__item-change-button",cancelItemButton:".collection__item-cancel-button",deleteItemButton:".collection__item-delete-button",itemSelectorTemplate:".collection__{}-item-template",collectionEmptyState:"collection--empty",itemCheckedState:"collection__item--checked",itemRemovingState:"collection__item--removing",urls:{createCollection:"",deleteCollection:"",uploadItem:"",changeItem:"",deleteItem:"",sortItems:""}},t||{}),this.element=e,this.input=this.element.querySelector(this._opts.input),!this.input)throw new Error(`Not found element "${this._opts.input}"`);if(this.itemContainer=this.element.querySelector(this._opts.itemContainer),!this.itemContainer)throw new Error(`Not found element "${this._opts.itemContainer}"`);if(this.createButton=this.element.querySelector(this._opts.createButton),!this.createButton)throw new Error(`Not found element "${this._opts.createButton}"`);if(this.uploadButton=this.element.querySelector(this._opts.uploadButton),!this.uploadButton)throw new Error(`Not found element "${this._opts.uploadButton}"`);if(this.deleteButton=this.element.querySelector(this._opts.deleteButton),!this.deleteButton)throw new Error(`Not found element "${this._opts.deleteButton}"`);this.init()}function L(e){e.closest(".empty-form")||new T(e,{urls:{createCollection:e.dataset.createCollectionUrl,deleteCollection:e.dataset.deleteCollectionUrl,uploadItem:e.dataset.uploadItemUrl,changeItem:e.dataset.changeItemUrl,deleteItem:e.dataset.deleteItemUrl,sortItems:e.dataset.sortItemsUrl}})}function N(e=document.body){e.matches(".collection")&&L(e),e.querySelectorAll(".collection").forEach(L)}var j;T.prototype=Object.create(k.prototype),Object.defineProperty(T.prototype,"collectionId",{get:function(){return parseInt(this.input.value)},set:function(e){const t=parseInt(e);if(isNaN(t)){this.input.value="",this.createButton.disabled=!1,this.uploadButton.disabled=!0,this.deleteButton.disabled=!0,this.element.classList.add(this._opts.collectionEmptyState);const e=this.uploadButton.querySelector('input[type="file"]');e&&(e.disabled=!0)}else{this.input.value=t,this.createButton.disabled=!0,this.uploadButton.disabled=!1,this.deleteButton.disabled=!1,this.element.classList.remove(this._opts.collectionEmptyState);const e=this.uploadButton.querySelector('input[type="file"]');e&&(e.disabled=!1)}}}),T.prototype.init=function(){this.uploader=this.initUploader(),this.sortable=this.initSortable(),this.collectionId=this.input.value,this.addListeners()},T.prototype.initUploader=function(){const e=this;return new d(this.element,{url:this._opts.urls.uploadItem,multiple:!0,maxConnections:4,button:this.uploadButton,dropzones:this.element.querySelectorAll(".dropzone-overlay"),validation:JSON.parse(this.element.dataset.validation),extraData:{collectionId:function(){return e.collectionId}}}).on("submit",(function(){if(isNaN(e.collectionId))throw new c})).on("submitted",(function(t){const n=e.element.querySelector(e._opts.preloaderTemplate),o=document.importNode(n.content,!0),i=o.querySelector(e._opts.item);i.dataset.queueId=t,i.classList.add(`item-preloader-${t}`);const r=this.uploader.getFile(t),a=i.querySelector(e._opts.itemName);a&&(a.title=r.name,a.textContent=r.name),e.itemContainer.append(o),e.trigger("collection:submit_item",[i,t])})).on("upload",(function(t){const n=e.itemContainer.querySelector(`.item-preloader-${t}`);e.trigger("collection:upload_item",[n,t])})).on("progress",(function(t,n){const o=e.itemContainer.querySelector(`.item-preloader-${t}`),i=o.querySelector(".progress-bar");i&&(i.style.height=n+"%"),n>=100&&o.classList.add("processing")})).on("complete",(function(t,n){isNaN(e.collectionId)&&(e.collectionId=n.collectionId,e.trigger("collection:created"));const o=e.itemContainer.querySelector(`.item-preloader-${t}`);e.trigger("collection:complete_item",[o,t]);const i=n.item_type,r=e._opts.itemSelectorTemplate.replace("{}",i),a=e.element.querySelector(r);if(a){{const t=document.importNode(a.content,!0),r=t.querySelector(e._opts.item);r.setAttribute("data-pk",n.id),r.setAttribute("data-item-type",i);const s=t.querySelector(e._opts.itemPreview);s&&(s.innerHTML=n.preview);const u=t.querySelector(e._opts.itemLink);u&&(u.href=n.url);const l=t.querySelector(e._opts.itemName);l&&(l.title=n.name,l.textContent=n.name),o.before(t)}o.remove()}else e.trigger("error",[t,`Invalid item_type: ${i}`])})).on("cancel",(function(t){const n=e.itemContainer.querySelector(`.item-preloader-${t}`);e.trigger("collection:cancel_item",[n,t]),n&&(n.addEventListener("animationend",(function(){n.remove()})),n.classList.add(e._opts.itemRemovingState))})).on("error",(function(t,n){var o;o=n,console.debug(`Collect error: ${o}`),"string"==typeof o?h.push(o):Array.isArray(o)&&(h=h.concat(o));const i=e.itemContainer.querySelector(`.item-preloader-${t}`);i&&(i.addEventListener("animationend",(function(){i.remove()})),i.classList.add(e._opts.itemRemovingState))})).on("all_complete",(function(){h&&h.length&&setTimeout((function(){h&&h.length&&(f.alert({title:"Error",message:m(h)}),h=[])}))}))},T.prototype.initSortable=function(){const e=this;return P.create(this.itemContainer,{animation:0,draggable:this._opts.item,filter:this._opts.preloaderItem,handle:".sortable-handler",ghostClass:"sortable-ghost",onEnd:function(){const t=Array.from(e.itemContainer.querySelectorAll(e._opts.item)).map((function(t){if(!t.matches(e._opts.preloaderItem))return t.dataset.pk})).filter(Boolean),n=new FormData,o=p(e.element);Object.keys(o).forEach((function(e){n.append(e,o[e])})),n.append("collectionId",e.collectionId.toString()),n.append("order",t.join(",")),fetch(e._opts.urls.sortItems,{method:"POST",credentials:"same-origin",body:n}).then((function(e){if(!e.ok){const t=new Error(`${e.status} ${e.statusText}`);throw t.response=e,t}return e.json()})).then((function(e){if(e.errors&&e.errors.length){const t=new Error("Invalid request");throw t.response=e,t}})).catch((function(e){"object"==typeof e&&e.response&&e.response.errors?q(e.response.errors):e instanceof Error?q(e.message):q(e)}))}})},T.prototype.cleanItems=function(){for(;this.itemContainer.firstChild;)this.itemContainer.removeChild(this.itemContainer.firstChild)},T.prototype._createCollection=function(){if(!isNaN(this.collectionId))return;const e=new FormData,t=p(this.element);Object.keys(t).forEach((function(n){e.append(n,t[n])}));const n=this;Promise.all([O.show(),fetch(this._opts.urls.createCollection,{method:"POST",credentials:"same-origin",body:e})]).then((function(e){const t=e[1];if(!t.ok){const e=new Error(`${t.status} ${t.statusText}`);throw e.response=t,e}return t.json()})).then((function(e){if(e.errors&&e.errors.length){const t=new Error("Invalid request");throw t.response=e,t}O.hide(),n.collectionId=e.collection_id,n.trigger("collection:created")})).catch((function(e){O.hide(),"object"==typeof e&&e.response&&e.response.errors?q(e.response.errors):e instanceof Error?q(e.message):q(e)}))},T.prototype._deleteItem=function(e){if(isNaN(this.collectionId))return;const t=parseInt(e&&e.dataset.pk);if(isNaN(t))return;const n=new FormData,o=p(this.element);Object.keys(o).forEach((function(e){n.append(e,o[e])})),n.append("collectionId",this.collectionId.toString()),n.append("instance_id",t.toString()),n.append("item_type",e.dataset.itemType);const i=this;Promise.all([O.show(),fetch(this._opts.urls.deleteItem,{method:"POST",credentials:"same-origin",body:n})]).then((function(e){const t=e[1];if(!t.ok){const e=new Error(`${t.status} ${t.statusText}`);throw e.response=t,e}return t.json()})).then((function(t){if(t.errors&&t.errors.length){const e=new Error("Invalid request");throw e.response=t,e}O.hide(),e.addEventListener("animationend",(function(){e.remove()})),e.classList.add(i._opts.itemRemovingState)})).catch((function(e){O.hide(),"object"==typeof e&&e.response&&e.response.errors?q(e.response.errors):e instanceof Error?q(e.message):q(e)}))},T.prototype._changeItem=function(e,t){if(isNaN(this.collectionId))return;const n=parseInt(e&&e.dataset.pk);if(isNaN(n))return;const o=this,i=t.find("form");Promise.all([O.show(),fetch(i.prop("action"),{method:"POST",credentials:"same-origin",body:new FormData(i.get(0))})]).then((function(e){const t=e[1];if(!t.ok){const e=new Error(`${t.status} ${t.statusText}`);throw e.response=t,e}return t.json()})).then((function(n){if(n.errors&&n.errors.length){const e=new Error("Invalid request");throw e.response=n,e}if(O.hide(),B.cleanFormErrors(i.get(0)),n.form_errors)B.addFormErrorsFromJSON(i.get(0),n.form_errors);else{t.modal("hide");const i=e.querySelector(o._opts.itemPreview);i&&(i.innerHTML=n.preview);const r=e.querySelector(o._opts.itemLink);r&&(r.href=n.url);const a=e.querySelector(o._opts.itemName);a&&(a.title=n.name,a.textContent=n.name)}})).catch((function(e){O.hide(),"object"==typeof e&&e.response&&e.response.errors?q(e.response.errors):e instanceof Error?q(e.message):q(e)}))},T.prototype._deleteCollection=function(){if(isNaN(this.collectionId))return;const e=new FormData,t=p(this.element);Object.keys(t).forEach((function(n){e.append(n,t[n])})),e.append("collectionId",this.collectionId.toString());const n=this;Promise.all([O.show(),fetch(this._opts.urls.deleteCollection,{method:"POST",credentials:"same-origin",body:e})]).then((function(e){const t=e[1];if(!t.ok){const e=new Error(`${t.status} ${t.statusText}`);throw e.response=t,e}return t.json()})).then((function(e){if(e.errors&&e.errors.length){const t=new Error("Invalid request");throw t.response=e,t}O.hide();let t=null;Array.from(n.itemContainer.children).forEach((function(e){e.classList.add(n._opts.itemRemovingState),t=e})),t?t.addEventListener("animationend",(function(){n.cleanItems(),n.collectionId="",n.trigger("collection:deleted")})):(n.cleanItems(),n.collectionId="",n.trigger("collection:deleted"))})).catch((function(e){O.hide(),"object"==typeof e&&e.response&&e.response.errors?q(e.response.errors):e instanceof Error?q(e.message):q(e)}))},T.prototype._checkItem=function(e,t=!0){e.classList.toggle(this._opts.itemCheckedState,t),e.querySelector(this._opts.itemCheckbox).checked=t},T.prototype.addListeners=function(){const e=this;this.element.addEventListener("click",(function(t){t.target.closest(e._opts.createButton)&&(t.preventDefault(),e._createCollection())})),this.element.addEventListener("click",(function(t){t.target.closest(e._opts.deleteButton)&&(t.preventDefault(),R.dialog({size:"small",title:gettext("Confirmation"),message:gettext("Are you sure you want to <b>DELETE</b> this collection?"),onEscape:!0,buttons:{cancel:{label:gettext("Cancel"),className:"btn-outline-info"},confirm:{label:gettext("Delete"),className:"btn-danger",callback:function(){e._deleteCollection()}}}}))})),this.element.addEventListener("click",(function(t){if(!t.target.closest(e._opts.changeItemButton))return;t.preventDefault();const n=t.target.closest(e._opts.item),o=parseInt(n&&n.dataset.pk);if(isNaN(o))return;const i=new FormData,r=p(e.element);Object.keys(r).forEach((function(e){i.append(e,r[e])})),i.append("collectionId",e.collectionId.toString()),i.append("instance_id",o.toString()),i.append("item_type",n.dataset.itemType);const a=new URLSearchParams(i).toString();Promise.all([O.show(),fetch(`${e._opts.urls.changeItem}?${a}`,{credentials:"same-origin"})]).then((function(e){const t=e[1];if(!t.ok){const e=new Error(`${t.status} ${t.statusText}`);throw e.response=t,e}return t.json()})).then((function(t){if(t.errors&&t.errors.length){const e=new Error("Invalid request");throw e.response=t,e}O.hide();const o=R.dialog({title:gettext("Edit file"),message:t.form,onEscape:!0,buttons:{cancel:{label:gettext("Cancel"),className:"btn-outline-info"},ok:{label:gettext("Save"),className:"btn-success",callback:function(){return e._changeItem(n,this),!1}}}});o.find("form").on("submit",(function(){return e._changeItem(n,o),!1}))})).catch((function(e){O.hide(),"object"==typeof e&&e.response&&e.response.errors?q(e.response.errors):e instanceof Error?q(e.message):q(e)}))})),this.element.addEventListener("click",(function(t){if(!t.target.closest(e._opts.cancelItemButton))return;t.preventDefault();const n=t.target.closest(e._opts.item),o=parseInt(n.dataset.queueId);e.uploader.uploader.cancel(o)})),this.element.addEventListener("click",(function(t){t.target.closest(e._opts.deleteItemButton)&&(t.preventDefault(),R.dialog({size:"small",title:gettext("Confirmation"),message:gettext("Are you sure you want to <b>DELETE</b> this file?"),onEscape:!0,buttons:{cancel:{label:gettext("Cancel"),className:"btn-outline-info"},confirm:{label:gettext("Delete"),className:"btn-danger",callback:function(){const n=t.target.closest(e._opts.item);e._deleteItem(n)}}}}))}));let t=null;this.element.addEventListener("click",(function(n){const o=n.target.closest(e._opts.item);if(!o)return;let i,r=n.target.closest(e._opts.itemCheckbox);if(r)i=r.checked;else{if(!n.ctrlKey&&!n.shiftKey)return;if(!(r=o.querySelector(e._opts.itemCheckbox)))return;i=!r.checked}if(t&&n.shiftKey&&t!==o){const n=Array.from(e.itemContainer.querySelectorAll(e._opts.item)),r=n.indexOf(t),a=n.indexOf(o),s=Math.min(r,a),u=Math.max(r,a);n.slice(s,u+1).forEach((function(t){e._checkItem(t,i)}))}else e._checkItem(o,i);t=o})),this.element.addEventListener("keyup",(function(t){if("Delete"===t.code){const t=Array.from(e.itemContainer.querySelectorAll(e._opts.item)).filter((function(t){return t.querySelector(e._opts.itemCheckbox).checked}));t.length&&R.dialog({size:"small",title:gettext("Confirmation"),message:gettext(`Are you sure you want to <b>DELETE</b> the selected <b>${t.length}</b> file(s)?`),onEscape:!0,buttons:{cancel:{label:gettext("Cancel"),className:"btn-outline-info"},confirm:{label:gettext("Delete"),className:"btn-danger",callback:function(){t.forEach((function(t){e._deleteItem(t)}))}}}})}})),this.element.addEventListener("dblclick",(function(t){const n=t.target.closest(e._opts.item);if(!n)return;const o=n.querySelector(e._opts.itemLink);o&&o.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0}))}))},A(N),U.dom.on("mutate",N),(j=n(8)).keys().map(j)}]);
//# sourceMappingURL=widget.min.js.map